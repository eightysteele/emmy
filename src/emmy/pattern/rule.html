<!DOCTYPE html>
<html><head><title>Rules</title><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="A &apos;rule&apos; is a combination of a possibly-failing matcher (see emmy.match), an optional matcher predicate that can introduce NEW bindings, and a consequence function (see emmy.consequence)" property="og:description"><meta content="Rules" property="og:title"><meta content="article:clerk" property="og:type"><meta content="summary_large_image" name="twitter:card"><script src="https://cdn.tailwindcss.com?plugins=typography" type="text/javascript"></script><script>tailwind.config = {
  darkMode: "class",
  content: ["./tw/viewer.js", "./tw/**/*.edn"],
  safelist: ['dark'],
  theme: {
    extend: {},
    fontFamily: {
      sans: ["Fira Sans", "-apple-system", "BlinkMacSystemFont", "sans-serif"],
      serif: ["PT Serif", "serif"],
      mono: ["Fira Mono", "monospace"]
    }
  },
  variants: {
    extend: {},
  },
  plugins: [],
}
</script><style type="text/tailwindcss">@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html {
    font-size: 18px;
  }
  @media (max-width: 600px) {
    html {
      font-size: 16px;
    }
  }
  .font-condensed { font-family: "Fira Sans Condensed", sans-serif; }
  .font-inter     { font-family: "Inter", sans-serif; }
  body {
    @apply font-serif antialiased text-gray-900 sm:overscroll-y-none;
  }
  code, .code {
    @apply font-mono text-sm text-gray-900 bg-slate-50 px-0.5 py-px rounded dark:bg-gray-800;
  }
  code::before, code::after { @apply content-none !important; }
  h1, h3, h4, h5, h6 {
    @apply font-condensed font-bold mt-8 first:mt-0;
  }
  h2 {
    /*We cannot collapse margins due to nesting but we want to*/
    /*keep the h2’s large margin visible*/
    @apply font-condensed font-bold mt-8 first:mt-2;
  }
  h1 { @apply text-4xl; }
  h2 { @apply text-3xl; }
  h3 { @apply text-2xl; }

  @media print {
      h1 { @apply text-2xl !important; }
      h2 { @apply text-xl !important; }
      h3 { @apply text-lg !important; }
  }

  button { @apply focus:outline-none; }
  strong { @apply font-bold; }
  em     { @apply italic; }
  pre    { @apply m-0 font-mono; }
}

/* Compatibility */
/* --------------------------------------------------------------- */
/* TODO: Verify which colors are in use and replace with Tailwind
   colors accordingly. Move Nj-specific styles out of here. */

:root {
  --teal-color: #31afd0;
  --dark-teal-color: #095960;
  --near-black-color: #2e2e2c;
  --red-color: #d64242;
  --dark-blue-color: #1f2937;
  --dark-blue-60-color: rgba(28, 42, 56, 0.6);
  --gray-panel-color: rgba(239, 241, 245, 1.000);
  --brand-color: var(--dark-blue-color);
  --link-color: #5046e4;
  --command-bar-selected-color: var(--teal-color);
}

.serif      { @apply font-serif; }
.sans-serif { @apply font-sans; }
.monospace  { @apply font-mono; }
.inter      { @apply font-inter; }

.border-color-teal { border-color: var(--dark-teal-color); }
.teal { color: var(--teal-color); }
.bg-dark-blue { background: var(--dark-blue-color); }
.bg-dark-blue-60 { background: rgba(28, 42, 56, 0.6); }
.bg-gray-panel { background: var(--gray-panel-color); }
.text-dark-blue  { color: var(--dark-blue-color); }
.text-dark-blue-60 { color: var(--dark-blue-60-color); }
.border-dark-blue-30 { border-color: rgba(28, 42, 56, 0.6); }
.text-brand { color: var(--dark-blue-color); }
.bg-brand { background: var(--dark-blue-color); }
.text-selected { color: white; }
.red { color: var(--red-color); }

/* Disclose Button */
/* --------------------------------------------------------------- */

.disclose {
  @apply content-none border-solid cursor-pointer inline-block relative mr-[3px] top-[-2px] transition-all;
  border-color: var(--near-black-color) transparent;
  border-width: 6px 4px 0;
}
.disclose:hover {
  border-color: var(--near-black-color) transparent;
}
.dark .disclose,
.dark .disclose:hover {
  border-color: white transparent;
}
.disclose.collapsed {
  @apply rotate-[-90deg];
}

/* Layout */
/* --------------------------------------------------------------- */

.page {
  @apply max-w-5xl mx-auto px-12 box-border flex-shrink-0;
}
.max-w-prose { @apply max-w-[46rem] !important; }
.max-w-wide  { @apply max-w-3xl !important; }

/* List Styles */
/* --------------------------------------------------------------- */

.task-list-item + .task-list-item,
.markdown-viewer ul ul {
  @apply mt-1 mb-0;
}

/* compact TOC */
.markdown-viewer .toc ul {
  list-style: none;
  @apply my-1;
}

/* Code Viewer */
/* --------------------------------------------------------------- */

.code-viewer {
  @apply font-mono bg-slate-100 rounded-sm text-sm overflow-x-auto dark:bg-gray-800;
}
.code-listing  {
    @apply -ml-8 -mr-8 relative !important;
}
.code-viewer .cm-content {
  @apply py-4 px-8;
}
@media (min-width: 960px){
    .notebook-viewer .code-viewer .cm-content {
        @apply py-4 pl-12;
    }
    .notebook-viewer .code-listing {
        width: 48rem !important;
        @apply -ml-12 mr-0 !important;
    }
}
/* Don’t show focus outline when double-clicking cell in Safari */
.cm-scroller { @apply focus:outline-none; }

/* Syntax Highlighting */
/* --------------------------------------------------------------- */

.inspected-value { @apply text-xs font-mono leading-[1.25rem]; }
.cmt-strong, .cmt-heading { @apply font-bold; }
.cmt-italic, .cmt-emphasis { @apply italic; }
.cmt-strikethrough { @apply line-through; }
.cmt-link { @apply underline; }
.untyped-value { @apply whitespace-nowrap; }

.cm-editor, .cmt-default, .result-viewer {
  @apply text-slate-800 dark:text-slate-300;
}
.cmt-keyword {
  @apply text-purple-800 dark:text-pink-400;
}
.cmt-atom, .cmt-bool, .cmt-url, .cmt-contentSeparator, .cmt-labelName {
  @apply text-blue-900 dark:text-blue-300;
}
.cmt-inserted, .cmt-literal {
  @apply text-emerald-700 dark:text-emerald-200;
}
.cmt-string, .cmt-deleted {
  @apply text-rose-700 dark:text-sky-300;
}
.cmt-italic.cmt-string {
  @apply dark:text-sky-200;
}
.cmt-regexp, .cmt-escape {
  @apply text-orange-500 dark:text-orange-300;
}
.cmt-variableName {
  @apply text-blue-800 dark:text-sky-300;
}
.cmt-typeName, .cmt-namespace {
  @apply text-emerald-600 dark:text-emerald-300;
}
.cmt-className {
  @apply text-teal-600 dark:text-teal-200;
}
.cmt-macroName {
  @apply text-teal-700 dark:text-teal-200;
}
.cmt-propertyName {
  @apply text-blue-700 dark:text-blue-200;
}
.cmt-comment {
  @apply text-slate-500 dark:text-slate-400;
}
.cmt-meta {
  @apply text-slate-600 dark:text-slate-400;
}
.cmt-invalid {
  @apply text-red-500 dark:text-red-300;
}

.result-data {
  @apply font-mono text-sm overflow-x-auto whitespace-nowrap leading-normal;
}
.result-data::-webkit-scrollbar, .path-nav::-webkit-scrollbar {
  @apply h-0;
}
.result-data-collapsed {
  @apply whitespace-nowrap;
}
.result-data-field {
  @apply ml-4 whitespace-nowrap;
}
.result-data-field-link{
  @apply ml-4 whitespace-nowrap cursor-pointer;
}
.result-data-field-link:hover {
  @apply text-black bg-black/5;
}
.result-text-empty {
  color: rgba(0,0,0,.3);
}
.browsify-button:hover {
  box-shadow: -2px 0 0 2px #edf2f7;
}

/* Prose */
/* --------------------------------------------------------------- */

.notebook-viewer,
.markdown-viewer {
  @apply prose
    dark:prose-invert
    prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline
    dark:prose-a:text-blue-300
    prose-p:mt-4 prose-p:leading-snug
    prose-ol:mt-4 prose-ol:mb-6 prose-ol:leading-snug
    prose-ul:mt-4 prose-ul:mb-6 prose-ul:leading-snug
    prose-blockquote:mt-4 prose-blockquote:leading-snug
    prose-hr:mt-6 prose-hr:border-t-2 prose-hr:border-solid prose-hr:border-slate-200
    prose-figure:mt-4
    prose-figcaption:mt-2 prose-figcaption:text-xs
    prose-headings:mb-4
    prose-table:mt-0
    prose-th:mb-0
    prose-img:my-0
    prose-code:font-medium prose-code:bg-slate-100
    max-w-none;
}
.markdown-viewer blockquote p:first-of-type:before,
.markdown-viewer blockquote p:last-of-type:after {
  @apply content-none;
}
.markdown-node-viewer.result-viewer.fragment-item {
    @apply mb-0 !important;
}

/* Images */
/* --------------------------------------------------------------- */


/* Todo Lists */
/* --------------------------------------------------------------- */

.contains-task-list {
  @apply pl-6 list-none;
}
.contains-task-list input[type="checkbox"] {
  @apply appearance-none h-4 w-4 rounded border border-slate-200 relative mr-[0.3rem] ml-[-1.5rem] top-[0.15rem];
}
.contains-task-list input[type="checkbox"]:checked {
  @apply border-indigo-600 bg-indigo-600 bg-no-repeat bg-contain;
  background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
}

/* Markdown TOC */
/* --------------------------------------------------------------- */

.markdown-viewer .toc      { @apply mt-4; }
.markdown-viewer h1 + .toc { @apply mt-8; }

.markdown-viewer .toc h1,
.markdown-viewer .toc h2,
.markdown-viewer .toc h3,
.markdown-viewer .toc h4,
.markdown-viewer .toc h5,
.markdown-viewer .toc h6 {
  @apply text-base text-indigo-600 font-sans my-0;
}
.markdown-viewer .toc a {
  @apply text-indigo-600 font-normal no-underline hover:underline;
}
.markdown-viewer .toc li    { @apply m-0; }
.markdown-viewer .toc ul ul { @apply pl-4; }

/* Notebook Spacing */
/* --------------------------------------------------------------- */

.notebook-viewer { @apply py-16; }
#clerk-static-app .notebook-viewer { @apply pt-[0.8rem] pb-16; }
.markdown-viewer *:first-child:not(.code-viewer):not(li):not(h2):not(.sidenote) { @apply mt-0; }
/*.viewer + .viewer { @apply mt-6; }*/
.viewer + .result-viewer { @apply mt-0; }
.code-viewer + .result-viewer { @apply mt-3; }
.markdown-viewer + .markdown-viewer { @apply mt-0; }

/* Sidenotes */
/* --------------------------------------------------------------- */

.sidenote-ref {
  @apply top-[-0.5em] w-auto h-auto inline border-0 bg-transparent m-0 pointer-events-none;
}
.sidenote {
  @apply block font-sans text-xs mt-4 bg-slate-100 dark:bg-slate-800 p-4;
  font-style: normal;
  font-weight: normal;
}
.sidenote-container {
  @apply mb-4;
}
@media (min-width: 860px) {
  .sidenote sup { @apply inline; }
  .sidenote-column {
    @apply w-[165px] absolute right-0 top-0 -mr-[205px];
  }
  .sidenote {
    @apply bg-transparent dark:bg-transparent p-0;
  }
  .sidenote:first-child {
    @apply mt-1;
  }
  .sidenotes-layout .markdown-viewer {
    @apply pr-[241px];
  }
  .sidenote-container {
    @apply relative mb-0;
  }
  .sidenotes-layout h1 {
    @apply w-[756px] !important;
  }
}
.code-viewer + .viewer:not(.code-viewer):not(.code-viewer-folded),
.code-viewer-folded + .viewer:not(.code-viewer):not(.code-viewer-folded),
.result-viewer:not(.markdown-node-viewer) + .result-viewer {
  @apply mt-2;
}
.code-viewer + .code-viewer-folded {
  @apply mt-4;
}
.result-viewer {
  @apply leading-tight mb-6;
}
.code-viewer.fragment-item.result-viewer {
  @apply mb-0 !important;
}
.result-viewer figure {
  @apply mt-0 !important;
}
@media (min-width: 768px) {
  .devcard-desc > div {
    @apply max-w-full m-0;
  }
}

/* Command Palette */
/* --------------------------------------------------------------- */

.nj-commands-input {
  @apply bg-transparent text-white;
}
.nj-context-menu-item:hover:not([disabled]) {
  @apply cursor-pointer;
  background-color: rgba(255,255,255,.14);
}

/* Devdocs */
/* --------------------------------------------------------------- */

.logo, .logo-white {
  @apply block indent-[-999em];
  background: url(/images/nextjournal-logo.svg) center center no-repeat;
}
.devdocs-body {
  @apply font-inter;
}

/* Workarounds */
/* --------------------------------------------------------------- */

/* Fixes vega viewer resizing into infinity */
.vega-embed .chart-wrapper { @apply h-auto !important; }
/* fixes fraction separators being overridden by tw’s border-color */
.katex * { @apply border-black; }

@media print {
    .dark-mode-toggle,
    .toc-toggle { @apply hidden; }
    .notebook-viewer { @apply pt-0; font-size: 12pt !important; margin-left: 0 !important; }
    .code-viewer .cm-content,
    .viewer-code .cm-content { @apply whitespace-pre-wrap !important; overflow: none; }
    .code-viewer .cm-line { font-size: 12pt !important; }
    html * { page-break-inside: avoid !important; }
    .toc-panel { @apply hidden; }
}
</style><script src="https://storage.clerk.garden/nextjournal/clerk-assets@4NdW4yYfmUzzw9xCkmyrJ75nH75d/viewer.js?immutable=true" type="module"></script><link href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.bunny.net" rel="preconnect"><link href="https://fonts.bunny.net/css?family=fira-mono:400,700%7Cfira-sans:400,400i,500,500i,700,700i%7Cfira-sans-condensed:700,700i%7Cpt-serif:400,400i,700,700i" rel="stylesheet" type="text/css"></head><body><div id="clerk-static-app"></div><script type="module">let state = "{:out-path \"public/build\", :path->doc {\"src/emmy/pattern/rule.cljc\" {:path [], :nextjournal/value {:toc {:type :toc, :children [{:children [{:type :toc, :content [{:type :text, :text \"Rules\"}], :heading-level 2, :attrs {:id \"rules\"}, :path [:content 0], :children [{:type :toc, :content [{:type :text, :text \"Defining Rules\"}], :heading-level 3, :attrs {:id \"defining-rules\"}, :path [:content 6]}]} {:type :toc, :content [{:type :text, :text \"Rules, Rule Combinators\"}], :heading-level 2, :attrs {:id \"rules,-rule-combinators\"}, :path [:content 10]} {:type :toc, :content [{:type :text, :text \"Expression Matchers\"}], :heading-level 2, :attrs {:id \"expression-matchers\"}, :path [:content 12]} {:type :toc, :content [{:type :text, :text \"Term Rewriting\"}], :heading-level 2, :attrs {:id \"term-rewriting\"}, :path [:content 14]}], :type :toc}]}, :sidenotes? false, :toc-visibility true, :atom-var-name->state #viewer-eval (nextjournal.clerk.render/intern-atoms! {}), :ns #viewer-eval (ns emmy.pattern.rule), :auto-expand-results? nil, :scope emmy.pattern.rule, :bundle? false, :open-graph {:type \"article:clerk\", :title \"Rules\", :description \"A 'rule' is a combination of a possibly-failing matcher (see emmy.match), an optional matcher predicate that can introduce NEW bindings, and a consequence function (see emmy.consequence)\"}, :title \"Rules\", :blocks [{:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"emmy.pattern.rule/markdown-5dsUFMJKoWYMfiAj5H6N5kAfL2wpjS\"} [\"h2\" {:id \"rules\"} [:<> \"Rules\"]] [:p [:<> \"A 'rule' is a combination of a possibly-failing matcher (see\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:code [:<> \"emmy.match\"]] [:<> \"), an optional matcher predicate that can introduce NEW\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"bindings, and a consequence function (see \"] [:code [:<> \"emmy.consequence\"]] [:<> \")\"]] [:ul [:li [:<> [:<> \"the matcher (and its predicate) determine whether or not the rule applies\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"to its data input, and\"]]] [:li [:<> [:<> \"The consequence can either fail, or successfully return some arbitrary\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"value or transformation of the bindings from the successful match\"]]]] [:p [:<> \"The final rule is a function from a data input to either failure or a\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"successful transformation.\"]] [:p [:<> \"This namespace defines:\"]] [:ul [:li [:<> [:<> \"the machinery required to create rules, in both function and macro form\"]]] [:li [:<> [:<> \"some basic rules\"]]] [:li [:<> [:<> \"combinators to build more advanced rules and term rewriting systems out of\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"basic rules. These are called \\\"rule combinators\\\".\"]]]] [\"h3\" {:id \"defining-rules\"} [:<> \"Defining Rules\"]] [:p [:<> \"Rules are composed from matchers and consequences; these functions are\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"politely aliased into this namespace to make it more self contained.\"]]], :nextjournal/opts {:id \"emmy.pattern.rule/markdown-5dsUFMJKoWYMfiAj5H6N5kAfL2wpjS\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-with-react-key, :hash \"5drtFhRgc8WMLrXw6DB4bZLsNZjHHp\"}} {:path [], :nextjournal/value \"(def =>\\n  \\\"Convenient predicate that always passes.\\\"\\n  (constantly true))\", :nextjournal/opts {:id \"emmy.pattern.rule/=>-code\", :loc {:line 45, :end-line 47, :column 1, :end-column 21}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[clojure.core$constantly$fn__5740 0x26050e26 \\\"clojure.core$constantly$fn__5740@26050e26\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/=>-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/=>-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(def !=>\\n  \\\"Predicate that fails for all inputs.\\\"\\n  (constantly false))\", :nextjournal/opts {:id \"emmy.pattern.rule/!=>-code\", :loc {:line 49, :end-line 51, :column 1, :end-column 22}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[clojure.core$constantly$fn__5740 0x2c8d187c \\\"clojure.core$constantly$fn__5740@2c8d187c\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/!=>-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/!=>-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(import-def c/succeed)\", :nextjournal/opts {:id \"emmy.pattern.rule/anon-expr-5duC9Lt2NLZYCbcrtH16Z7mEWMHPtt-code\", :loc {:line 53, :end-line 53, :column 1, :end-column 23}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value emmy.pattern.consequence/succeed, :nextjournal/opts {:id \"emmy.pattern.rule/anon-expr-5duC9Lt2NLZYCbcrtH16Z7mEWMHPtt-result\"}, :nextjournal/viewer {:render-fn #viewer-fn (fn [x] [:span.inspected-value [:span.cmt-meta \"#'\" (str x)]]), :hash \"5drVRdpy8ciJYX39zFxxrNrNizFH2i\"}}, :nextjournal/blob-id \"5duEAuMR3RPtxX3HL76GHJzv51wzy9\"}, :nextjournal/opts {:id \"emmy.pattern.rule/anon-expr-5duC9Lt2NLZYCbcrtH16Z7mEWMHPtt-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(import-def m/failure)\", :nextjournal/opts {:id \"emmy.pattern.rule/anon-expr-5dt2vVCjeWW1Uji8sgcs6hWcuyv3aZ-code\", :loc {:line 54, :end-line 54, :column 1, :end-column 23}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value emmy.pattern.match/failure, :nextjournal/opts {:id \"emmy.pattern.rule/anon-expr-5dt2vVCjeWW1Uji8sgcs6hWcuyv3aZ-result\"}, :nextjournal/viewer {:render-fn #viewer-fn (fn [x] [:span.inspected-value [:span.cmt-meta \"#'\" (str x)]]), :hash \"5drVRdpy8ciJYX39zFxxrNrNizFH2i\"}}, :nextjournal/blob-id \"5drFFFo6TavWDfMj7RbXQ7fRj6yUxa\"}, :nextjournal/opts {:id \"emmy.pattern.rule/anon-expr-5dt2vVCjeWW1Uji8sgcs6hWcuyv3aZ-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(import-def m/failed?)\", :nextjournal/opts {:id \"emmy.pattern.rule/anon-expr-5dtsfeSPBunSQQYxvp5GjCyt9nsGcN-code\", :loc {:line 55, :end-line 55, :column 1, :end-column 23}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value emmy.pattern.match/failed?, :nextjournal/opts {:id \"emmy.pattern.rule/anon-expr-5dtsfeSPBunSQQYxvp5GjCyt9nsGcN-result\"}, :nextjournal/viewer {:render-fn #viewer-fn (fn [x] [:span.inspected-value [:span.cmt-meta \"#'\" (str x)]]), :hash \"5drVRdpy8ciJYX39zFxxrNrNizFH2i\"}}, :nextjournal/blob-id \"5dssibHEq3uiMxBXCJm9TJ8UDBb126\"}, :nextjournal/opts {:id \"emmy.pattern.rule/anon-expr-5dtsfeSPBunSQQYxvp5GjCyt9nsGcN-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"emmy.pattern.rule/markdown-5drw1s8FPuhBbFdjU7gonQrwPLBua5\"} [:p [:<> \"[[pattern*]] is effectively an alias for [[match/matcher]]; the macro\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"form, [[pattern]], is able to take a pattern with un-quoted forms like \"] [:code [:<> \"?x\"]] [:<> \".\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"See [[syntax/compile-pattern]] for details.\"]] [:p [:<> \"NOTE: These should almost certainly live in \"] [:code [:<> \"emmy.match\"]] [:<> \". Can we alias a\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"macro into this namespace with Potemkin?\"]]], :nextjournal/opts {:id \"emmy.pattern.rule/markdown-5drw1s8FPuhBbFdjU7gonQrwPLBua5\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-with-react-key, :hash \"5drtFhRgc8WMLrXw6DB4bZLsNZjHHp\"}} {:path [], :nextjournal/value \"(defn pattern*\\n  \\\"Builds the pattern portion of a rule from the supplied pattern form or matcher\\n  combinator and optional predicate `pred`.\\n\\n  See [[emmy.pattern.syntax]] for the allowed syntax pattern, or [[emmy.pattern.match]]\\n  for details on matcher combinators.\\n\\n  See [[match/matcher]] for more detailed documentation.\\\"\\n  ([form]\\n   (m/matcher form))\\n  ([form pred]\\n   (if (and pred (not= pred =>))\\n     (m/matcher form pred)\\n     (m/matcher form))))\", :nextjournal/opts {:id \"emmy.pattern.rule/pattern*-code\", :loc {:line 64, :end-line 77, :column 1, :end-column 25}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$pattern_STAR_ 0x39afb2c4 \\\"emmy.pattern.rule$pattern_STAR_@39afb2c4\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/pattern*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/pattern*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defmacro pattern\\n  \\\"Takes an unevaluated pattern form (or matcher combinator) and an optional\\n  predicate `pred`, and returns a matcher appropriate for passing to [[rule*]].\\\"\\n  ([form]\\n   `(pattern*\\n     ~(ps/compile-pattern form)))\\n  ([form pred]\\n   `(pattern*\\n     ~(ps/compile-pattern form)\\n     ~@(when pred [pred]))))\", :nextjournal/opts {:id \"emmy.pattern.rule/pattern-code\", :loc {:line 79, :end-line 88, :column 1, :end-column 29}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$pattern 0x1502a0c9 \\\"emmy.pattern.rule$pattern@1502a0c9\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/pattern-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/pattern-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defmacro consequence\\n  \\\"Accepts a skeleton expression `form` and returns a function from a pattern\\n  matcher's binding map to a data structure of identical shape to `skel`, with:\\n\\n  - all variable binding forms like `?x` replaced by their entries in the\\n    binding map\\n  - same with any segment or reverse-segment binding form like `??x` or `$$x`,\\n    with the added note that these will be spliced in\\n  - any `unquote` or `unquote-splicing` forms respected.\\n\\n  Compared to [[template]], these two forms are equivalent:\\n\\n  ```clojure\\n  (fn [m] (template m <form>))\\n  (consequence <form>)\\n  ```\\\"\\n  [form]\\n  (let [sym (gensym)]\\n    `(fn [~sym]\\n       ~(c/compile-skeleton sym form))))\", :nextjournal/opts {:id \"emmy.pattern.rule/consequence-code\", :loc {:line 90, :end-line 109, :column 1, :end-column 41}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$consequence 0x1bf8e871 \\\"emmy.pattern.rule$consequence@1bf8e871\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/consequence-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/consequence-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defmacro template\\n  \\\"Provided with a single `form`, [[template]] is similar to Clojure's `unquote`\\n  facility, except that symbols are not prefixed by namespace. For example:\\n\\n  ```clojure\\n  (let [x 10]\\n    (template (+ ~x y z ~@[4 5])))\\n  ;;=> (+ 10 y z 4 5)\\n  ```\\n\\n  When you provide a binding map `m`, [[template]] returns its input form, but\\n  replaces any:\\n\\n  - variable binding form like `?x`\\n  - segment binding form like `??x`\\n  - reverse-segment binding form, like `$$x`\\n\\n  with the appropriate entry in `m`. (`m` can be a symbol referencing a binding\\n  map in the environment.)\\n\\n  Splices and unquote splices are respected. For example:\\n\\n  ```clojure\\n  (let [m {'?x 10 '?y 12 '??z [1 2 3]}]\\n    (template m (+ ?x ?y ??z ~m ~@[1 2])))\\n  ;;=> (+ 10 12 1 2 3 {?x 10, ?y 12, ??z [1 2 3]} 1 2)\\n  ```\\\"\\n  ([form]\\n   (c/compile-skeleton {} form))\\n  ([m form]\\n   (let [sym (gensym)]\\n     `(let [~sym ~m]\\n        ~(c/compile-skeleton sym form)))))\", :nextjournal/opts {:id \"emmy.pattern.rule/template-code\", :loc {:line 111, :end-line 143, :column 1, :end-column 43}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$template 0x5f724d8a \\\"emmy.pattern.rule$template@5f724d8a\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/template-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/template-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn rule*\\n  \\\"Functional version of [[rule]]. See [[rule]] for documentation.\\\"\\n  [match handler]\\n  (let [match (if (fn? match)\\n                match\\n                (m/matcher match))]\\n    (fn [data]\\n      (let [result (match data)]\\n        (if (m/failed? result)\\n          m/failure\\n          (c/unwrap\\n           (or (handler result)\\n               m/failure)))))))\", :nextjournal/opts {:id \"emmy.pattern.rule/rule*-code\", :loc {:line 145, :end-line 157, :column 1, :end-column 32}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$rule_STAR_ 0x1b8fed32 \\\"emmy.pattern.rule$rule_STAR_@1b8fed32\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/rule*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/rule*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn ^:no-doc compile-rule\\n  \\\"Returns compiled, macro-ready input for [[rule*]] based on the contract\\n  described by [[rule]].\\\"\\n  ([p consequent-fn]\\n   `(rule* (pattern ~p)\\n           ~consequent-fn))\\n\\n  ([p pred skeleton]\\n   `(rule* (pattern ~p ~pred)\\n           (consequence ~skeleton))))\", :nextjournal/opts {:id \"emmy.pattern.rule/compile-rule-code\", :loc {:line 159, :end-line 168, :column 1, :end-column 38}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$compile_rule 0x1b8b1262 \\\"emmy.pattern.rule$compile_rule@1b8b1262\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/compile-rule-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/compile-rule-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defmacro rule\\n  \\\"Accepts either:\\n\\n  - A pattern written using the syntax from `emmy.pattern.syntax` and a consequence\\n    function from binding map => failure or return form, or\\n  - A pattern, predicate and a consequence _skeleton_,\\n\\n  And returns a rule. A rule is a function from some data object to either\\n\\n  - A special `failure` singleton (test for this with [[failed?]]), or\\n  - A successful transformation provided by a consequence function.\\n\\n  In the 2-argument case, you must provide an explicit function of the binding\\n  map. A return of `failure`, `nil` or `false` will cause the whole rule to\\n  fail. To successfully return `nil` or `false`, wrap the result in [[succeed]].\\n\\n  Notes for the 3-argument case:\\n\\n  - If the predicate returns `nil`, `false` or `failure`, the rule fails.\\n\\n  - The predicate can succeed by returning anything else. If the return value is\\n    a map, the rule will call the consequence function with this map merged in to\\n    the bindings.\\n\\n  - the third form is a consequence 'skeleton' instead of an explicit function\\n    See [[consequence]] for details.\\\"\\n  ([pattern consequent-fn]\\n   (compile-rule pattern consequent-fn))\\n  ([pattern pred skeleton]\\n   (compile-rule pattern pred skeleton)))\", :nextjournal/opts {:id \"emmy.pattern.rule/rule-code\", :loc {:line 170, :end-line 199, :column 1, :end-column 42}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$rule 0x476cda02 \\\"emmy.pattern.rule$rule@476cda02\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/rule-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/rule-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"emmy.pattern.rule/markdown-5dt5HW29srPVWkaMHA6N6JxwirUaLq\"} [\"h2\" {:id \"rules,-rule-combinators\"} [:<> \"Rules, Rule Combinators\"]] [:p [:<> \"The following section defines a small set of basic rules, as well as a series\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"of rule \\\"combinators\\\". These are functions that take one or more rules as\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"inputs and return a new rule.\"]]], :nextjournal/opts {:id \"emmy.pattern.rule/markdown-5dt5HW29srPVWkaMHA6N6JxwirUaLq\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-with-react-key, :hash \"5drtFhRgc8WMLrXw6DB4bZLsNZjHHp\"}} {:path [], :nextjournal/value \"(defn pass\\n  \\\"Rule that always succeeds by returning its input data unchanged.\\\"\\n  [data] data)\", :nextjournal/opts {:id \"emmy.pattern.rule/pass-code\", :loc {:line 207, :end-line 209, :column 1, :end-column 15}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$pass 0xabfc178 \\\"emmy.pattern.rule$pass@abfc178\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/pass-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/pass-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn fail\\n  \\\"Rule that always fails with an explicit `failure`, no matter the input.\\\"\\n  [_] failure)\", :nextjournal/opts {:id \"emmy.pattern.rule/fail-code\", :loc {:line 211, :end-line 213, :column 1, :end-column 15}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$fail 0x6ebd5b60 \\\"emmy.pattern.rule$fail@6ebd5b60\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/fail-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/fail-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn predicate\\n  \\\"Returns a rule that will pass its input data on unchanged if `(f data)` returns\\n  true and fail otherwise.\\\"\\n  [f]\\n  (fn [data]\\n    (if (f data)\\n      data\\n      failure)))\", :nextjournal/opts {:id \"emmy.pattern.rule/predicate-code\", :loc {:line 215, :end-line 222, :column 1, :end-column 17}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$predicate 0x2d665cd7 \\\"emmy.pattern.rule$predicate@2d665cd7\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/predicate-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/predicate-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn return\\n  \\\"Returns a rule that matches any input and always returns `x`.\\\"\\n  [x]\\n  (fn [_] x))\", :nextjournal/opts {:id \"emmy.pattern.rule/return-code\", :loc {:line 224, :end-line 227, :column 1, :end-column 14}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$return 0xc7b2fb3 \\\"emmy.pattern.rule$return@c7b2fb3\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/return-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/return-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn branch\\n  \\\"Takes a rule `r` and returns a new rule that calls `r` with its input.\\n\\n  The returned rule returns:\\n\\n  - `(succeed-r (r data)) if `(r data)` is successful,\\n  - `(fail-r data) otherwise.\\\"\\n  [r succeed-r fail-r]\\n  (fn [data]\\n    (let [result (r data)]\\n      (if (failed? result)\\n        (fail-r data)\\n        (succeed-r result)))))\", :nextjournal/opts {:id \"emmy.pattern.rule/branch-code\", :loc {:line 229, :end-line 241, :column 1, :end-column 31}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$branch 0x783b8b45 \\\"emmy.pattern.rule$branch@783b8b45\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/branch-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/branch-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn choice*\\n  \\\"Identical to the multi-arity [[choice]], but accepts an explicit sequence.\\\"\\n  [rules]\\n  (fn [data]\\n    (loop [rules rules]\\n      (if (empty? rules)\\n        failure\\n        (let [answer ((first rules) data)]\\n          (if (failed? answer)\\n            (recur (rest rules))\\n            answer))))))\", :nextjournal/opts {:id \"emmy.pattern.rule/choice*-code\", :loc {:line 243, :end-line 253, :column 1, :end-column 25}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$choice_STAR_ 0x7c59b979 \\\"emmy.pattern.rule$choice_STAR_@7c59b979\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/choice*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/choice*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn choice\\n  \\\"Accepts any number of `rules` and returns a new `rule` that attempts to apply\\n  each rule in `rules` to its input data. Returns the first non-failing rule's\\n  result, or `failure` if no rule succeeds.\\n\\n  NOTE: The zero-arity `(choice)` returns [[fail]], a rule that fails for any\\n  input.\\n\\n  See [[choice*]] for an identical function that accepts an explicit sequence.\\\"\\n  ([] fail)\\n  ([r] r)\\n  ([r & rs]\\n   (choice* (cons r rs))))\", :nextjournal/opts {:id \"emmy.pattern.rule/choice-code\", :loc {:line 255, :end-line 267, :column 1, :end-column 27}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$choice 0x63c6d2c1 \\\"emmy.pattern.rule$choice@63c6d2c1\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/choice-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/choice-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn pipe*\\n  \\\"Identical to the multi-arity [[pipe]], but accepts an explicit sequence.\\\"\\n  [rules]\\n  (fn [data]\\n    (reduce (fn [prev r]\\n              (let [result (r prev)]\\n                (if (failed? result)\\n                  (reduced failure)\\n                  result)))\\n            data\\n            rules)))\", :nextjournal/opts {:id \"emmy.pattern.rule/pipe*-code\", :loc {:line 269, :end-line 279, :column 1, :end-column 21}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$pipe_STAR_ 0x36956fbd \\\"emmy.pattern.rule$pipe_STAR_@36956fbd\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/pipe*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/pipe*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn pipe\\n  \\\"Accepts any number of `rules` and returns a new `rule` that attempts to pipe\\n  its input `data` through each rule in `rules`. Only succeeds if every rule\\n  succeeds on the previous rule's successful output.\\n\\n  NOTE: The zero-arity `(pipe)` returns [[pass]], a rule that succeeds for any\\n  input by returning the input unchanged.\\n\\n  See [[pipe*]] for an identical function that accepts an explicit sequence.\\\"\\n  ([] pass)\\n  ([r] r)\\n  ([r & rs]\\n   (pipe* (cons r rs))))\", :nextjournal/opts {:id \"emmy.pattern.rule/pipe-code\", :loc {:line 281, :end-line 293, :column 1, :end-column 25}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$pipe 0x1250ab89 \\\"emmy.pattern.rule$pipe@1250ab89\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/pipe-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/pipe-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn n-times\\n  \\\"Returns a rule that applies the rule `r` iteratively `n` times to the input\\n  data, failing if any application fails.\\n\\n  For example, these forms are equivalent, except that the [[n-times]] version\\n  will fail immediately if any application fails vs passing on its failure:\\n\\n  ```clojure\\n  (n-times 3 my-rule)\\n  (fn [data]\\n    (my-rule (my-rule (my-rule data))))\\n  ```\\\"\\n  [n r]\\n  (pipe* (repeat n r)))\", :nextjournal/opts {:id \"emmy.pattern.rule/n-times-code\", :loc {:line 295, :end-line 308, :column 1, :end-column 24}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$n_times 0x23735acb \\\"emmy.pattern.rule$n_times@23735acb\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/n-times-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/n-times-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn attempt?\\n  \\\"Returns `true` if `r` was marked as an 'attempt' rule, i.e., a rule that will\\n  never fail, but return its input on a failed match.\\\"\\n  [r]\\n  (::attempt? (meta r) false))\", :nextjournal/opts {:id \"emmy.pattern.rule/attempt?-code\", :loc {:line 310, :end-line 314, :column 1, :end-column 31}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$attempt_QMARK_ 0x7676d4be \\\"emmy.pattern.rule$attempt_QMARK_@7676d4be\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/attempt?-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/attempt?-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn as-attempt\\n  \\\"Marks the supplied rule as an 'attempt' rule that won't fail.\\\"\\n  [r]\\n  (vary-meta r assoc ::attempt? true))\", :nextjournal/opts {:id \"emmy.pattern.rule/as-attempt-code\", :loc {:line 316, :end-line 319, :column 1, :end-column 39}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$as_attempt 0x6b03b54a \\\"emmy.pattern.rule$as_attempt@6b03b54a\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/as-attempt-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/as-attempt-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn attempt\\n  \\\"Takes a rule `r` and returns a new rule that return either `(r data)` if `r` is\\n  successful, or its original input on failure.\\n\\n  NOTE that the returned rule will never fail! This makes it inappropriate to\\n  use with [[choice]], for example, if you expect any rule supplied after this\\n  one to ever be matched. [[attempt]] rules are great choices for the final rule\\n  passed to [[choice]], however.\\\"\\n  [r]\\n  (if (attempt? r)\\n    r\\n    (as-attempt\\n     (choice r pass))))\", :nextjournal/opts {:id \"emmy.pattern.rule/attempt-code\", :loc {:line 321, :end-line 333, :column 1, :end-column 24}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$attempt 0x7c184740 \\\"emmy.pattern.rule$attempt@7c184740\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/attempt-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/attempt-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn guard\\n  \\\"Takes a predicate function `f` and a rule `r`, and returns a new rule that will\\n  return `(r data)` if `(f data)` is true, fail otherwise.\\\"\\n  [f r]\\n  (pipe (predicate f) r))\", :nextjournal/opts {:id \"emmy.pattern.rule/guard-code\", :loc {:line 335, :end-line 339, :column 1, :end-column 26}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$guard 0x4504ff0a \\\"emmy.pattern.rule$guard@4504ff0a\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/guard-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/guard-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn iterated\\n  \\\"Similar to `clojure.core/iterate` for rule application.\\n\\n  Takes a rule `r` and returns a new rule that will return the last non-failing\\n  result of the sequence `[data (r data) (r (r data)) ...]`\\n\\n  This might be `data` itself if `r` fails on first application. This means that\\n  the returned rule will never fail.\\\"\\n  [r]\\n  (as-attempt\\n   (fn [data]\\n     (let [result (r data)]\\n       (if (failed? result)\\n         data\\n         (recur result))))))\", :nextjournal/opts {:id \"emmy.pattern.rule/iterated-code\", :loc {:line 341, :end-line 355, :column 1, :end-column 29}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$iterated 0x5170030 \\\"emmy.pattern.rule$iterated@5170030\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/iterated-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/iterated-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn while\\n  \\\"Returns a new rule which repeatedly applies `r` as long as `f` continues to\\n  return `true` between the input and output of the rule `r` applied iteratively\\n  to the input `data`.\\n\\n  See [[until]] for a similar function that treats its predicate differently.\\\"\\n  [f r]\\n  (as-attempt\\n   (fn rec [data]\\n     ((pipe (attempt r)\\n            (fn [data*]\\n              (if (f data data*)\\n                (rec data*)\\n                data*)))\\n      data))))\", :nextjournal/opts {:id \"emmy.pattern.rule/while-code\", :loc {:line 357, :end-line 371, :column 1, :end-column 15}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$while 0x73485c3d \\\"emmy.pattern.rule$while@73485c3d\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/while-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/while-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn until\\n  \\\"Returns a new rule which repeatedly applies `r` until `f` returns `true`\\n  between the input and output of the rule `r` applied iteratively to the input\\n  `data`, signaling completion.\\n\\n  See [[while]] for a similar function that treats its predicate differently.\\\"\\n  [f r]\\n  (as-attempt\\n   (fn [data]\\n     (let [data* ((attempt r) data)]\\n       (if (f data data*)\\n         data*\\n         (recur data*))))))\", :nextjournal/opts {:id \"emmy.pattern.rule/until-code\", :loc {:line 373, :end-line 385, :column 1, :end-column 28}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$until 0x4d543753 \\\"emmy.pattern.rule$until@4d543753\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/until-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/until-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn fixed-point\\n  \\\"Takes a rule `r` and returns a new rule that applies `r` to `data` iteratively\\n  until (= input (r input)).\\\"\\n  [r]\\n  (until = r))\", :nextjournal/opts {:id \"emmy.pattern.rule/fixed-point-code\", :loc {:line 387, :end-line 391, :column 1, :end-column 15}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$fixed_point 0x2fca6d5c \\\"emmy.pattern.rule$fixed_point@2fca6d5c\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/fixed-point-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/fixed-point-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn trace\\n  \\\"Takes a rule `r` and returns a new version of `r` tagged with a unique `id`.\\n  The returned rule calls the side-effecting `f` with\\n\\n  ```clojure\\n  {:id id, :in data}\\n  ```\\n\\n  Before calling `r` with `data`, and calls `f` with\\n\\n  ```clojure\\n  {:id id, :out (r data)}\\n  ```\\n\\n  when the rule returns.\\\"\\n  ([r]\\n   (trace r prn))\\n  ([r f]\\n   (let [id (gensym \\\"t_\\\")]\\n     (fn [data]\\n       (f {:id id, :in data})\\n       (let [result (r data)]\\n         (f {:id id, :out result})\\n         result)))))\", :nextjournal/opts {:id \"emmy.pattern.rule/trace-code\", :loc {:line 393, :end-line 416, :column 1, :end-column 21}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$trace 0x12e1fe15 \\\"emmy.pattern.rule$trace@12e1fe15\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/trace-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/trace-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"emmy.pattern.rule/markdown-5drv3G9tqy1cV1GniuUR15ryzgPcN2\"} [\"h2\" {:id \"expression-matchers\"} [:<> \"Expression Matchers\"]] [:p [:<> \"The next group of rule combinators are designed to accept an expression built\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"out of Clojure data structures and apply the rule in either depth-first or\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"breadth-first fashion.\"]]], :nextjournal/opts {:id \"emmy.pattern.rule/markdown-5drv3G9tqy1cV1GniuUR15ryzgPcN2\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-with-react-key, :hash \"5drtFhRgc8WMLrXw6DB4bZLsNZjHHp\"}} {:path [], :nextjournal/value \"(defn- try-subexpressions\\n  \\\"Given a rule `the-rule` and a possibly-nested expression `expr`, attempts to\\n  apply `the-rule` to all subexpressions in breadth-first order. If the\\n  transformed form is equivalent, returns its input so that [[identical?]]\\n  checks before and after don't break.\\n\\n  Descends correctly into vectors, sequences and dictionaries.\\n\\n  NOTE: [[try-subexpressions]] assumes that [[the-rule]] will always succeed,\\n  returning its input on a failed match.\\\"\\n  [the-rule expr]\\n  (cond (sequential? expr)\\n        (let [processed (doall (map the-rule expr))]\\n          (if (= expr processed)\\n            expr\\n            (if (vector? expr)\\n              (vec processed)\\n              processed)))\\n\\n        (map? expr)\\n        (let [processed (u/map-vals the-rule expr)]\\n          (if (= expr processed)\\n            expr\\n            processed))\\n\\n        :else expr))\", :nextjournal/opts {:id \"emmy.pattern.rule/try-subexpressions-code\", :loc {:line 424, :end-line 449, :column 1, :end-column 21}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$try_subexpressions 0x2379e1c0 \\\"emmy.pattern.rule$try_subexpressions@2379e1c0\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/try-subexpressions-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/try-subexpressions-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn bottom-up\\n  \\\"Given some rule `the-rule`, returns a new rule that accepts potentially nested\\n  `data` and applies `the-rule` to all subexpressions in depth-first order, from\\n  the leaves on up.\\n\\n  The transformation is applied a single time to all subexpressions.\\n  See [[iterated-bottom-up]] for a version that will iterate to convergence.\\\"\\n  [the-rule]\\n  (let [r (attempt the-rule)]\\n    (as-attempt\\n     (fn rec [expression]\\n       (r (try-subexpressions rec expression))))))\", :nextjournal/opts {:id \"emmy.pattern.rule/bottom-up-code\", :loc {:line 451, :end-line 462, :column 1, :end-column 51}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$bottom_up 0x4f7ba453 \\\"emmy.pattern.rule$bottom_up@4f7ba453\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/bottom-up-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/bottom-up-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn top-down\\n  \\\"Given some rule `the-rule`, returns a new rule that accepts potentially nested\\n  `data` and applies `the-rule` to all subexpressions on the way down AND back\\n  up a traversal. This is a sort of hybrid of breadth-first, depth-first.\\n\\n  The transformation is applied a single time to all subexpressions.\\n  See [[iterated-top-down]] for a version that will iterate to convergence.\\\"\\n  [the-rule]\\n  (let [r (attempt the-rule)]\\n    (as-attempt\\n     (fn rec [expr]\\n       (r (try-subexpressions rec (r expr)))))))\", :nextjournal/opts {:id \"emmy.pattern.rule/top-down-code\", :loc {:line 464, :end-line 475, :column 1, :end-column 49}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$top_down 0x33a7906d \\\"emmy.pattern.rule$top_down@33a7906d\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/top-down-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/top-down-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn iterated-bottom-up\\n  \\\"Version of [[bottom-up]] that iterates on each subexpression to convergence\\n  before each subexpression returns. Any change in a subexpression triggers a\\n  new iterated-bottom-up replacement of that subexpression.\\n\\n  The returned rule keeps an internal memoization cache and will return\\n  immediately for subexpressions it's seen before.\\\"\\n  [the-rule]\\n  (let [r   (attempt the-rule)\\n        rec (atom nil)]\\n    (letfn [(rec* [expr]\\n              (let [processed (try-subexpressions @rec expr)\\n                    answer (r processed)]\\n                (if (= answer processed)\\n                  answer\\n                  (@rec answer))))]\\n      (reset! rec (memoize rec*))\\n      (as-attempt @rec))))\", :nextjournal/opts {:id \"emmy.pattern.rule/iterated-bottom-up-code\", :loc {:line 477, :end-line 494, :column 1, :end-column 27}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$iterated_bottom_up 0x2eabc15a \\\"emmy.pattern.rule$iterated_bottom_up@2eabc15a\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/iterated-bottom-up-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/iterated-bottom-up-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn iterated-top-down\\n  \\\"Version of [[top-down]] that iterates on each subexpression to convergence\\n  before each subexpression returns. Any change in a subexpression triggers a\\n  new iterated-top-down replacement of that subexpression.\\n\\n  The returned rule keeps an internal memoization cache and will return\\n  immediately for subexpressions it's seen before.\\\"\\n  [the-rule]\\n  (let [r   (attempt the-rule)\\n        rec (atom nil)]\\n    (letfn [(rec* [expr]\\n              (let [answer (r expr)]\\n                (if (= answer expr)\\n                  (let [processed (try-subexpressions @rec expr)\\n                        answer (r processed)]\\n                    (if (= answer processed)\\n                      answer\\n                      (@rec answer)))\\n                  (@rec answer))))]\\n      (reset! rec (memoize rec*))\\n      (as-attempt @rec))))\", :nextjournal/opts {:id \"emmy.pattern.rule/iterated-top-down-code\", :loc {:line 496, :end-line 516, :column 1, :end-column 27}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$iterated_top_down 0x423042ae \\\"emmy.pattern.rule$iterated_top_down@423042ae\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/iterated-top-down-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/iterated-top-down-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"emmy.pattern.rule/markdown-5drhukoTohffogdFJa9uVZ2AagK17L\"} [\"h2\" {:id \"term-rewriting\"} [:<> \"Term Rewriting\"]] [:p [:<> \"Term-rewriting systems often declare sets of rules meant to be attempted one\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"after the other, just like [[choice]]; but failure for term-rewriting should\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"return the term with no transformation.\"]]], :nextjournal/opts {:id \"emmy.pattern.rule/markdown-5drhukoTohffogdFJa9uVZ2AagK17L\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-with-react-key, :hash \"5drtFhRgc8WMLrXw6DB4bZLsNZjHHp\"}} {:path [], :nextjournal/value \"(defn ruleset*\\n  \\\"Given some number of `rules`, returns a new rule that will act like [[choice]]\\n  and attempt to apply each rule to the input data, returning the first match.\\n\\n  If all `rules` fail, the returned rule will return its input `data`.\\n\\n  See [[ruleset]] for a macro that allows inline rule definition.\\\"\\n  [& rules]\\n  (attempt\\n   (apply choice rules)))\", :nextjournal/opts {:id \"emmy.pattern.rule/ruleset*-code\", :loc {:line 524, :end-line 533, :column 1, :end-column 26}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$ruleset_STAR_ 0x507b2f87 \\\"emmy.pattern.rule$ruleset_STAR_@507b2f87\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/ruleset*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/ruleset*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defmacro ruleset\\n  \\\"Accepts triplets of the form:\\n\\n  <pattern> <predicate> <consequence-template>\\n\\n  and returns a new rule that will attempt to match the rules compiled from each\\n  triplet in sequence, returning the filled-in `<consequence-template>` of the\\n  first successful match.\\n\\n  If none of the rules match, the returned rule returns its input data\\n  unchanged.\\n\\n  See [[ruleset*]] for a function version that takes explicit\\n  already-constructed rules.\\\"\\n  [& patterns-and-consequences]\\n  {:pre (zero? (mod (count patterns-and-consequences) 3))}\\n  (let [inputs (partition 3 patterns-and-consequences)\\n        rules  (map #(apply compile-rule %) inputs)]\\n    `(ruleset* ~@rules)))\", :nextjournal/opts {:id \"emmy.pattern.rule/ruleset-code\", :loc {:line 535, :end-line 553, :column 1, :end-column 26}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$ruleset 0x5fd0f91d \\\"emmy.pattern.rule$ruleset@5fd0f91d\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/ruleset-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/ruleset-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn rule-simplifier\\n  \\\"Given some number of `rules`, returns a new rule that will attempt to apply\\n  each rule to its input expression (and every subexpression of the input,\\n  bottom up), iterating until no rule causes any change in any level of the\\n  supplied expression.\\\"\\n  [& rules]\\n  (iterated-bottom-up\\n   (apply pipe (map attempt rules))))\", :nextjournal/opts {:id \"emmy.pattern.rule/rule-simplifier-code\", :loc {:line 555, :end-line 562, :column 1, :end-column 38}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$rule_simplifier 0x2f8152ac \\\"emmy.pattern.rule$rule_simplifier@2f8152ac\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/rule-simplifier-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/rule-simplifier-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn term-rewriting\\n  \\\"Alias for [[rule-simplifier]].\\\"\\n  [& rules]\\n  (apply rule-simplifier rules))\", :nextjournal/opts {:id \"emmy.pattern.rule/term-rewriting-code\", :loc {:line 564, :end-line 567, :column 1, :end-column 33}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.rule$term_rewriting 0x6f6440c0 \\\"emmy.pattern.rule$term_rewriting@6f6440c0\\\"]\", :nextjournal/opts {:id \"emmy.pattern.rule/term-rewriting-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.rule/term-rewriting-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}}], :css-class nil}, :nextjournal/viewer {:name nextjournal.clerk.viewer/notebook-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-notebook, :hash \"5duAFDxE4sCnRX71Wo6zeCpC9C3djE\"}}}, :index \"dev/emmy/notebook.clj\", :browse? false, :git/url \"https://github.com/mentat-collective/emmy\", :paths [\"src/emmy/abstract/number.cljc\" \"src/emmy/special/elliptic.cljc\" \"src/emmy/polynomial/interpolate.cljc\" \"src/emmy/numerical/quadrature/midpoint.cljc\" \"src/emmy/numerical/quadrature/trapezoid.cljc\" \"src/emmy/sci.cljc\" \"src/emmy/calculus/map.cljc\" \"src/emmy/pattern/rule.cljc\" \"src/emmy/mechanics/time_evolution.cljc\" \"src/emmy/util/permute.cljc\" \"src/emmy/expression/cse.cljc\" \"src/emmy/complex.cljc\" \"src/emmy/generic.cljc\" \"src/emmy/expression/compile.cljc\" \"src/emmy/sr/frames.cljc\" \"src/emmy/function.cljc\" \"src/emmy/polynomial/richardson.cljc\" \"src/emmy/numerical/unimin/brent.cljc\" \"src/emmy/numsymb.cljc\" \"src/emmy/calculus/vector_field.cljc\" \"src/emmy/numerical/minimize.cljc\" \"src/emmy/rational_function.cljc\" \"src/emmy/mechanics/noether.cljc\" \"src/emmy/calculus/hodge_star.cljc\" \"src/emmy/series.cljc\" \"src/emmy/series/impl.cljc\" \"src/emmy/calculus/manifold.cljc\" \"src/emmy/util/logic.cljc\" \"src/emmy/util/stopwatch.cljc\" \"src/emmy/numerical/quadrature/adaptive.cljc\" \"src/emmy/mechanics/rotation.cljc\" \"src/emmy/numerical/ode.cljc\" \"src/emmy/numerical/quadrature/riemann.cljc\" \"src/emmy/calculus/connection.cljc\" \"src/emmy/numbers.cljc\" \"src/emmy/algebra/fold.cljc\" \"src/emmy/numerical/multimin/nelder_mead.cljc\" \"src/emmy/polynomial/exponent.cljc\" \"src/emmy/polynomial/factor.cljc\" \"src/emmy/util/def.cljc\" \"src/emmy/abstract/function.cljc\" \"src/emmy/calculus/indexed.cljc\" \"src/emmy/numerical/quadrature.cljc\" \"src/emmy/numerical/quadrature/infinite.cljc\" \"src/emmy/mechanics/routhian.cljc\" \"src/emmy/numerical/quadrature/bulirsch_stoer.cljc\" \"src/emmy/ratio.cljc\" \"src/emmy/calculus/curvature.cljc\" \"src/emmy/numerical/quadrature/milne.cljc\" \"src/emmy/calculus/form_field.cljc\" \"src/emmy/mechanics/hamilton.cljc\" \"src/emmy/expression/render.cljc\" \"src/emmy/util/stream.cljc\" \"src/emmy/calculus/derivative.cljc\" \"dev/emmy/notebook.clj\" \"src/emmy/util/aggregate.cljc\" \"src/emmy/numerical/quadrature/romberg.cljc\" \"src/emmy/numerical/quadrature/boole.cljc\" \"src/emmy/pattern/match.cljc\" \"src/emmy/calculus/metric.cljc\" \"src/emmy/polynomial/gcd.cljc\" \"src/emmy/numerical/quadrature/substitute.cljc\" \"src/emmy/euclid.cljc\" \"src/emmy/calculus/vector_calculus.cljc\" \"src/emmy/collection.cljc\" \"src/emmy/numerical/quadrature/simpson.cljc\" \"src/emmy/calculus/basis.cljc\" \"src/emmy/util/vector_set.cljc\" \"src/emmy/pattern/syntax.cljc\" \"src/emmy/numerical/quadrature/common.cljc\" \"src/emmy/sr/boost.cljc\" \"src/emmy/calculus/coordinate.cljc\" \"src/emmy/calculus/covariant.cljc\" \"src/emmy/numerical/derivative.cljc\" \"src/emmy/simplify/rules.cljc\" \"src/emmy/mechanics/rigid.cljc\" \"src/emmy/quaternion.cljc\" \"src/emmy/rational_function/interpolate.cljc\" \"src/emmy/numerical/unimin/bracket.cljc\" \"src/emmy/numerical/roots/bisect.cljc\" \"src/emmy/numerical/quadrature/simpson38.cljc\" \"src/emmy/mechanics/lagrange.cljc\" \"src/emmy/expression/analyze.cljc\" \"src/emmy/calculus/frame.cljc\" \"src/emmy/pattern/consequence.cljc\" \"src/emmy/env.cljc\" \"src/emmy/util.cljc\" \"src/emmy/matrix.cljc\" \"src/emmy/sci/macros.cljc\" \"src/emmy/numerical/unimin/golden.cljc\" \"src/emmy/special/factorial.cljc\" \"src/emmy/polynomial/impl.cljc\" \"src/emmy/modint.cljc\"], :resource->url {\"/js/viewer.js\" \"https://storage.clerk.garden/nextjournal/clerk-assets@4NdW4yYfmUzzw9xCkmyrJ75nH75d/viewer.js?immutable=true\"}, :current-path \"src/emmy/pattern/rule.cljc\", :bundle? false, :git/sha \"78ec5a5124dee5722005b26cef6cd911f46236e1\", :path->url {\"src/emmy/abstract/number.cljc\" \"src/emmy/abstract/number.html\", \"src/emmy/special/elliptic.cljc\" \"src/emmy/special/elliptic.html\", \"src/emmy/polynomial/interpolate.cljc\" \"src/emmy/polynomial/interpolate.html\", \"src/emmy/numerical/quadrature/midpoint.cljc\" \"src/emmy/numerical/quadrature/midpoint.html\", \"src/emmy/numerical/quadrature/trapezoid.cljc\" \"src/emmy/numerical/quadrature/trapezoid.html\", \"src/emmy/sci.cljc\" \"src/emmy/sci.html\", \"src/emmy/calculus/map.cljc\" \"src/emmy/calculus/map.html\", \"src/emmy/pattern/rule.cljc\" \"src/emmy/pattern/rule.html\", \"src/emmy/mechanics/time_evolution.cljc\" \"src/emmy/mechanics/time_evolution.html\", \"src/emmy/util/permute.cljc\" \"src/emmy/util/permute.html\", \"src/emmy/expression/cse.cljc\" \"src/emmy/expression/cse.html\", \"src/emmy/complex.cljc\" \"src/emmy/complex.html\", \"src/emmy/generic.cljc\" \"src/emmy/generic.html\", \"src/emmy/expression/compile.cljc\" \"src/emmy/expression/compile.html\", \"src/emmy/sr/frames.cljc\" \"src/emmy/sr/frames.html\", \"src/emmy/function.cljc\" \"src/emmy/function.html\", \"src/emmy/polynomial/richardson.cljc\" \"src/emmy/polynomial/richardson.html\", \"src/emmy/numerical/unimin/brent.cljc\" \"src/emmy/numerical/unimin/brent.html\", \"src/emmy/numsymb.cljc\" \"src/emmy/numsymb.html\", \"src/emmy/calculus/vector_field.cljc\" \"src/emmy/calculus/vector_field.html\", \"src/emmy/numerical/minimize.cljc\" \"src/emmy/numerical/minimize.html\", \"src/emmy/rational_function.cljc\" \"src/emmy/rational_function.html\", \"src/emmy/mechanics/noether.cljc\" \"src/emmy/mechanics/noether.html\", \"src/emmy/calculus/hodge_star.cljc\" \"src/emmy/calculus/hodge_star.html\", \"src/emmy/series.cljc\" \"src/emmy/series.html\", \"src/emmy/series/impl.cljc\" \"src/emmy/series/impl.html\", \"src/emmy/calculus/manifold.cljc\" \"src/emmy/calculus/manifold.html\", \"src/emmy/util/logic.cljc\" \"src/emmy/util/logic.html\", \"src/emmy/util/stopwatch.cljc\" \"src/emmy/util/stopwatch.html\", \"src/emmy/numerical/quadrature/adaptive.cljc\" \"src/emmy/numerical/quadrature/adaptive.html\", \"src/emmy/mechanics/rotation.cljc\" \"src/emmy/mechanics/rotation.html\", \"src/emmy/numerical/ode.cljc\" \"src/emmy/numerical/ode.html\", \"src/emmy/numerical/quadrature/riemann.cljc\" \"src/emmy/numerical/quadrature/riemann.html\", \"src/emmy/calculus/connection.cljc\" \"src/emmy/calculus/connection.html\", \"src/emmy/numbers.cljc\" \"src/emmy/numbers.html\", \"src/emmy/algebra/fold.cljc\" \"src/emmy/algebra/fold.html\", \"src/emmy/numerical/multimin/nelder_mead.cljc\" \"src/emmy/numerical/multimin/nelder_mead.html\", \"src/emmy/polynomial/exponent.cljc\" \"src/emmy/polynomial/exponent.html\", \"src/emmy/polynomial/factor.cljc\" \"src/emmy/polynomial/factor.html\", \"src/emmy/util/def.cljc\" \"src/emmy/util/def.html\", \"src/emmy/abstract/function.cljc\" \"src/emmy/abstract/function.html\", \"src/emmy/calculus/indexed.cljc\" \"src/emmy/calculus/indexed.html\", \"src/emmy/numerical/quadrature.cljc\" \"src/emmy/numerical/quadrature.html\", \"src/emmy/numerical/quadrature/infinite.cljc\" \"src/emmy/numerical/quadrature/infinite.html\", \"src/emmy/mechanics/routhian.cljc\" \"src/emmy/mechanics/routhian.html\", \"src/emmy/numerical/quadrature/bulirsch_stoer.cljc\" \"src/emmy/numerical/quadrature/bulirsch_stoer.html\", \"src/emmy/ratio.cljc\" \"src/emmy/ratio.html\", \"src/emmy/calculus/curvature.cljc\" \"src/emmy/calculus/curvature.html\", \"src/emmy/numerical/quadrature/milne.cljc\" \"src/emmy/numerical/quadrature/milne.html\", \"src/emmy/calculus/form_field.cljc\" \"src/emmy/calculus/form_field.html\", \"src/emmy/mechanics/hamilton.cljc\" \"src/emmy/mechanics/hamilton.html\", \"src/emmy/expression/render.cljc\" \"src/emmy/expression/render.html\", \"src/emmy/util/stream.cljc\" \"src/emmy/util/stream.html\", \"src/emmy/calculus/derivative.cljc\" \"src/emmy/calculus/derivative.html\", \"dev/emmy/notebook.clj\" \"\", \"src/emmy/util/aggregate.cljc\" \"src/emmy/util/aggregate.html\", \"src/emmy/numerical/quadrature/romberg.cljc\" \"src/emmy/numerical/quadrature/romberg.html\", \"src/emmy/numerical/quadrature/boole.cljc\" \"src/emmy/numerical/quadrature/boole.html\", \"src/emmy/pattern/match.cljc\" \"src/emmy/pattern/match.html\", \"src/emmy/calculus/metric.cljc\" \"src/emmy/calculus/metric.html\", \"src/emmy/polynomial/gcd.cljc\" \"src/emmy/polynomial/gcd.html\", \"src/emmy/numerical/quadrature/substitute.cljc\" \"src/emmy/numerical/quadrature/substitute.html\", \"src/emmy/euclid.cljc\" \"src/emmy/euclid.html\", \"src/emmy/calculus/vector_calculus.cljc\" \"src/emmy/calculus/vector_calculus.html\", \"src/emmy/collection.cljc\" \"src/emmy/collection.html\", \"src/emmy/numerical/quadrature/simpson.cljc\" \"src/emmy/numerical/quadrature/simpson.html\", \"src/emmy/calculus/basis.cljc\" \"src/emmy/calculus/basis.html\", \"src/emmy/util/vector_set.cljc\" \"src/emmy/util/vector_set.html\", \"src/emmy/pattern/syntax.cljc\" \"src/emmy/pattern/syntax.html\", \"src/emmy/numerical/quadrature/common.cljc\" \"src/emmy/numerical/quadrature/common.html\", \"src/emmy/sr/boost.cljc\" \"src/emmy/sr/boost.html\", \"src/emmy/calculus/coordinate.cljc\" \"src/emmy/calculus/coordinate.html\", \"src/emmy/calculus/covariant.cljc\" \"src/emmy/calculus/covariant.html\", \"src/emmy/numerical/derivative.cljc\" \"src/emmy/numerical/derivative.html\", \"src/emmy/simplify/rules.cljc\" \"src/emmy/simplify/rules.html\", \"src/emmy/mechanics/rigid.cljc\" \"src/emmy/mechanics/rigid.html\", \"src/emmy/quaternion.cljc\" \"src/emmy/quaternion.html\", \"src/emmy/rational_function/interpolate.cljc\" \"src/emmy/rational_function/interpolate.html\", \"src/emmy/numerical/unimin/bracket.cljc\" \"src/emmy/numerical/unimin/bracket.html\", \"src/emmy/numerical/roots/bisect.cljc\" \"src/emmy/numerical/roots/bisect.html\", \"src/emmy/numerical/quadrature/simpson38.cljc\" \"src/emmy/numerical/quadrature/simpson38.html\", \"src/emmy/mechanics/lagrange.cljc\" \"src/emmy/mechanics/lagrange.html\", \"src/emmy/expression/analyze.cljc\" \"src/emmy/expression/analyze.html\", \"src/emmy/calculus/frame.cljc\" \"src/emmy/calculus/frame.html\", \"src/emmy/pattern/consequence.cljc\" \"src/emmy/pattern/consequence.html\", \"src/emmy/env.cljc\" \"src/emmy/env.html\", \"src/emmy/util.cljc\" \"src/emmy/util.html\", \"src/emmy/matrix.cljc\" \"src/emmy/matrix.html\", \"src/emmy/sci/macros.cljc\" \"src/emmy/sci/macros.html\", \"src/emmy/numerical/unimin/golden.cljc\" \"src/emmy/numerical/unimin/golden.html\", \"src/emmy/special/factorial.cljc\" \"src/emmy/special/factorial.html\", \"src/emmy/polynomial/impl.cljc\" \"src/emmy/polynomial/impl.html\", \"src/emmy/modint.cljc\" \"src/emmy/modint.html\"}, :expanded-paths [\"src/emmy/series/impl.cljc\" \"src/emmy/sr/boost.cljc\" \"src/emmy/sr/frames.cljc\" \"src/emmy/expression/compile.cljc\" \"src/emmy/expression/cse.cljc\" \"src/emmy/expression/render.cljc\" \"src/emmy/expression/analyze.cljc\" \"src/emmy/abstract/number.cljc\" \"src/emmy/abstract/function.cljc\" \"src/emmy/numerical/roots/bisect.cljc\" \"src/emmy/numerical/ode.cljc\" \"src/emmy/numerical/minimize.cljc\" \"src/emmy/numerical/quadrature/simpson38.cljc\" \"src/emmy/numerical/quadrature/simpson.cljc\" \"src/emmy/numerical/quadrature/milne.cljc\" \"src/emmy/numerical/quadrature/common.cljc\" \"src/emmy/numerical/quadrature/boole.cljc\" \"src/emmy/numerical/quadrature/bulirsch_stoer.cljc\" \"src/emmy/numerical/quadrature/midpoint.cljc\" \"src/emmy/numerical/quadrature/substitute.cljc\" \"src/emmy/numerical/quadrature/riemann.cljc\" \"src/emmy/numerical/quadrature/trapezoid.cljc\" \"src/emmy/numerical/quadrature/romberg.cljc\" \"src/emmy/numerical/quadrature/adaptive.cljc\" \"src/emmy/numerical/quadrature/infinite.cljc\" \"src/emmy/numerical/multimin/nelder_mead.cljc\" \"src/emmy/numerical/unimin/bracket.cljc\" \"src/emmy/numerical/unimin/brent.cljc\" \"src/emmy/numerical/unimin/golden.cljc\" \"src/emmy/numerical/derivative.cljc\" \"src/emmy/numerical/quadrature.cljc\" \"src/emmy/pattern/consequence.cljc\" \"src/emmy/pattern/rule.cljc\" \"src/emmy/pattern/match.cljc\" \"src/emmy/pattern/syntax.cljc\" \"src/emmy/calculus/map.cljc\" \"src/emmy/calculus/frame.cljc\" \"src/emmy/calculus/manifold.cljc\" \"src/emmy/calculus/vector_field.cljc\" \"src/emmy/calculus/indexed.cljc\" \"src/emmy/calculus/vector_calculus.cljc\" \"src/emmy/calculus/coordinate.cljc\" \"src/emmy/calculus/hodge_star.cljc\" \"src/emmy/calculus/covariant.cljc\" \"src/emmy/calculus/curvature.cljc\" \"src/emmy/calculus/connection.cljc\" \"src/emmy/calculus/form_field.cljc\" \"src/emmy/calculus/derivative.cljc\" \"src/emmy/calculus/metric.cljc\" \"src/emmy/calculus/basis.cljc\" \"src/emmy/simplify/rules.cljc\" \"src/emmy/special/factorial.cljc\" \"src/emmy/special/elliptic.cljc\" \"src/emmy/polynomial/gcd.cljc\" \"src/emmy/polynomial/impl.cljc\" \"src/emmy/polynomial/factor.cljc\" \"src/emmy/polynomial/richardson.cljc\" \"src/emmy/polynomial/exponent.cljc\" \"src/emmy/polynomial/interpolate.cljc\" \"src/emmy/algebra/fold.cljc\" \"src/emmy/mechanics/time_evolution.cljc\" \"src/emmy/mechanics/hamilton.cljc\" \"src/emmy/mechanics/rotation.cljc\" \"src/emmy/mechanics/routhian.cljc\" \"src/emmy/mechanics/rigid.cljc\" \"src/emmy/mechanics/lagrange.cljc\" \"src/emmy/mechanics/noether.cljc\" \"src/emmy/sci/macros.cljc\" \"src/emmy/util/permute.cljc\" \"src/emmy/util/logic.cljc\" \"src/emmy/util/stream.cljc\" \"src/emmy/util/aggregate.cljc\" \"src/emmy/util/def.cljc\" \"src/emmy/util/stopwatch.cljc\" \"src/emmy/util/vector_set.cljc\" \"src/emmy/rational_function/interpolate.cljc\" \"src/emmy/collection.cljc\" \"src/emmy/complex.cljc\" \"src/emmy/euclid.cljc\" \"src/emmy/env.cljc\" \"src/emmy/function.cljc\" \"src/emmy/generic.cljc\" \"src/emmy/matrix.cljc\" \"src/emmy/modint.cljc\" \"src/emmy/numbers.cljc\" \"src/emmy/numsymb.cljc\" \"src/emmy/quaternion.cljc\" \"src/emmy/ratio.cljc\" \"src/emmy/rational_function.cljc\" \"src/emmy/sci.cljc\" \"src/emmy/series.cljc\" \"src/emmy/util.cljc\" \"dev/emmy/notebook.clj\"], :cname \"emmy.mentat.org\", :watch-paths [\"src\" \"dev\"], :report-fn #object[nextjournal.clerk.builder$stdout_reporter 0x88d355b \"nextjournal.clerk.builder$stdout_reporter@88d355b\"]}".replaceAll('nextjournal.clerk.view/escape-closing-script-tag', 'script')
let opts = nextjournal.clerk.sci_env.read_string(state)
nextjournal.clerk.static_app.init(opts)
</script></body></html>