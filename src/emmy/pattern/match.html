<!DOCTYPE html>
<html><head><title>Emmy Pattern Matching</title><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="The library is built out of a few stacked ideas: matcher combinators, matchers, consequences and rules." property="og:description"><meta content="Emmy Pattern Matching" property="og:title"><meta content="article:clerk" property="og:type"><meta content="summary_large_image" name="twitter:card"><script src="https://cdn.tailwindcss.com?plugins=typography" type="text/javascript"></script><script>tailwind.config = {
  darkMode: "class",
  content: ["./tw/viewer.js", "./tw/**/*.edn"],
  safelist: ['dark'],
  theme: {
    extend: {},
    fontFamily: {
      sans: ["Fira Sans", "-apple-system", "BlinkMacSystemFont", "sans-serif"],
      serif: ["PT Serif", "serif"],
      mono: ["Fira Mono", "monospace"]
    }
  },
  variants: {
    extend: {},
  },
  plugins: [],
}
</script><style type="text/tailwindcss">@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html {
    font-size: 18px;
  }
  @media (max-width: 600px) {
    html {
      font-size: 16px;
    }
  }
  .font-condensed { font-family: "Fira Sans Condensed", sans-serif; }
  .font-inter     { font-family: "Inter", sans-serif; }
  body {
    @apply font-serif antialiased text-gray-900 sm:overscroll-y-none;
  }
  code, .code {
    @apply font-mono text-sm text-gray-900 bg-slate-50 px-0.5 py-px rounded dark:bg-gray-800;
  }
  code::before, code::after { @apply content-none !important; }
  h1, h3, h4, h5, h6 {
    @apply font-condensed font-bold mt-8 first:mt-0;
  }
  h2 {
    /*We cannot collapse margins due to nesting but we want to*/
    /*keep the h2’s large margin visible*/
    @apply font-condensed font-bold mt-8 first:mt-2;
  }
  h1 { @apply text-4xl; }
  h2 { @apply text-3xl; }
  h3 { @apply text-2xl; }

  @media print {
      h1 { @apply text-2xl !important; }
      h2 { @apply text-xl !important; }
      h3 { @apply text-lg !important; }
  }

  button { @apply focus:outline-none; }
  strong { @apply font-bold; }
  em     { @apply italic; }
  pre    { @apply m-0 font-mono; }
}

/* Compatibility */
/* --------------------------------------------------------------- */
/* TODO: Verify which colors are in use and replace with Tailwind
   colors accordingly. Move Nj-specific styles out of here. */

:root {
  --teal-color: #31afd0;
  --dark-teal-color: #095960;
  --near-black-color: #2e2e2c;
  --red-color: #d64242;
  --dark-blue-color: #1f2937;
  --dark-blue-60-color: rgba(28, 42, 56, 0.6);
  --gray-panel-color: rgba(239, 241, 245, 1.000);
  --brand-color: var(--dark-blue-color);
  --link-color: #5046e4;
  --command-bar-selected-color: var(--teal-color);
}

.serif      { @apply font-serif; }
.sans-serif { @apply font-sans; }
.monospace  { @apply font-mono; }
.inter      { @apply font-inter; }

.border-color-teal { border-color: var(--dark-teal-color); }
.teal { color: var(--teal-color); }
.bg-dark-blue { background: var(--dark-blue-color); }
.bg-dark-blue-60 { background: rgba(28, 42, 56, 0.6); }
.bg-gray-panel { background: var(--gray-panel-color); }
.text-dark-blue  { color: var(--dark-blue-color); }
.text-dark-blue-60 { color: var(--dark-blue-60-color); }
.border-dark-blue-30 { border-color: rgba(28, 42, 56, 0.6); }
.text-brand { color: var(--dark-blue-color); }
.bg-brand { background: var(--dark-blue-color); }
.text-selected { color: white; }
.red { color: var(--red-color); }

/* Disclose Button */
/* --------------------------------------------------------------- */

.disclose {
  @apply content-none border-solid cursor-pointer inline-block relative mr-[3px] top-[-2px] transition-all;
  border-color: var(--near-black-color) transparent;
  border-width: 6px 4px 0;
}
.disclose:hover {
  border-color: var(--near-black-color) transparent;
}
.dark .disclose,
.dark .disclose:hover {
  border-color: white transparent;
}
.disclose.collapsed {
  @apply rotate-[-90deg];
}

/* Layout */
/* --------------------------------------------------------------- */

.page {
  @apply max-w-5xl mx-auto px-12 box-border flex-shrink-0;
}
.max-w-prose { @apply max-w-[46rem] !important; }
.max-w-wide  { @apply max-w-3xl !important; }

/* List Styles */
/* --------------------------------------------------------------- */

.task-list-item + .task-list-item,
.markdown-viewer ul ul {
  @apply mt-1 mb-0;
}

/* compact TOC */
.markdown-viewer .toc ul {
  list-style: none;
  @apply my-1;
}

/* Code Viewer */
/* --------------------------------------------------------------- */

.code-viewer {
  @apply font-mono bg-slate-100 rounded-sm text-sm overflow-x-auto dark:bg-gray-800;
}
.code-listing  {
    @apply -ml-8 -mr-8 relative !important;
}
.code-viewer .cm-content {
  @apply py-4 px-8;
}
@media (min-width: 960px){
    .notebook-viewer .code-viewer .cm-content {
        @apply py-4 pl-12;
    }
    .notebook-viewer .code-listing {
        width: 48rem !important;
        @apply -ml-12 mr-0 !important;
    }
}
/* Don’t show focus outline when double-clicking cell in Safari */
.cm-scroller { @apply focus:outline-none; }

/* Syntax Highlighting */
/* --------------------------------------------------------------- */

.inspected-value { @apply text-xs font-mono leading-[1.25rem]; }
.cmt-strong, .cmt-heading { @apply font-bold; }
.cmt-italic, .cmt-emphasis { @apply italic; }
.cmt-strikethrough { @apply line-through; }
.cmt-link { @apply underline; }
.untyped-value { @apply whitespace-nowrap; }

.cm-editor, .cmt-default, .result-viewer {
  @apply text-slate-800 dark:text-slate-300;
}
.cmt-keyword {
  @apply text-purple-800 dark:text-pink-400;
}
.cmt-atom, .cmt-bool, .cmt-url, .cmt-contentSeparator, .cmt-labelName {
  @apply text-blue-900 dark:text-blue-300;
}
.cmt-inserted, .cmt-literal {
  @apply text-emerald-700 dark:text-emerald-200;
}
.cmt-string, .cmt-deleted {
  @apply text-rose-700 dark:text-sky-300;
}
.cmt-italic.cmt-string {
  @apply dark:text-sky-200;
}
.cmt-regexp, .cmt-escape {
  @apply text-orange-500 dark:text-orange-300;
}
.cmt-variableName {
  @apply text-blue-800 dark:text-sky-300;
}
.cmt-typeName, .cmt-namespace {
  @apply text-emerald-600 dark:text-emerald-300;
}
.cmt-className {
  @apply text-teal-600 dark:text-teal-200;
}
.cmt-macroName {
  @apply text-teal-700 dark:text-teal-200;
}
.cmt-propertyName {
  @apply text-blue-700 dark:text-blue-200;
}
.cmt-comment {
  @apply text-slate-500 dark:text-slate-400;
}
.cmt-meta {
  @apply text-slate-600 dark:text-slate-400;
}
.cmt-invalid {
  @apply text-red-500 dark:text-red-300;
}

.result-data {
  @apply font-mono text-sm overflow-x-auto whitespace-nowrap leading-normal;
}
.result-data::-webkit-scrollbar, .path-nav::-webkit-scrollbar {
  @apply h-0;
}
.result-data-collapsed {
  @apply whitespace-nowrap;
}
.result-data-field {
  @apply ml-4 whitespace-nowrap;
}
.result-data-field-link{
  @apply ml-4 whitespace-nowrap cursor-pointer;
}
.result-data-field-link:hover {
  @apply text-black bg-black/5;
}
.result-text-empty {
  color: rgba(0,0,0,.3);
}
.browsify-button:hover {
  box-shadow: -2px 0 0 2px #edf2f7;
}

/* Prose */
/* --------------------------------------------------------------- */

.notebook-viewer,
.markdown-viewer {
  @apply prose
    dark:prose-invert
    prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline
    dark:prose-a:text-blue-300
    prose-p:mt-4 prose-p:leading-snug
    prose-ol:mt-4 prose-ol:mb-6 prose-ol:leading-snug
    prose-ul:mt-4 prose-ul:mb-6 prose-ul:leading-snug
    prose-blockquote:mt-4 prose-blockquote:leading-snug
    prose-hr:mt-6 prose-hr:border-t-2 prose-hr:border-solid prose-hr:border-slate-200
    prose-figure:mt-4
    prose-figcaption:mt-2 prose-figcaption:text-xs
    prose-headings:mb-4
    prose-table:mt-0
    prose-th:mb-0
    prose-img:my-0
    prose-code:font-medium prose-code:bg-slate-100
    max-w-none;
}
.markdown-viewer blockquote p:first-of-type:before,
.markdown-viewer blockquote p:last-of-type:after {
  @apply content-none;
}
.markdown-node-viewer.result-viewer.fragment-item {
    @apply mb-0 !important;
}

/* Images */
/* --------------------------------------------------------------- */


/* Todo Lists */
/* --------------------------------------------------------------- */

.contains-task-list {
  @apply pl-6 list-none;
}
.contains-task-list input[type="checkbox"] {
  @apply appearance-none h-4 w-4 rounded border border-slate-200 relative mr-[0.3rem] ml-[-1.5rem] top-[0.15rem];
}
.contains-task-list input[type="checkbox"]:checked {
  @apply border-indigo-600 bg-indigo-600 bg-no-repeat bg-contain;
  background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
}

/* Markdown TOC */
/* --------------------------------------------------------------- */

.markdown-viewer .toc      { @apply mt-4; }
.markdown-viewer h1 + .toc { @apply mt-8; }

.markdown-viewer .toc h1,
.markdown-viewer .toc h2,
.markdown-viewer .toc h3,
.markdown-viewer .toc h4,
.markdown-viewer .toc h5,
.markdown-viewer .toc h6 {
  @apply text-base text-indigo-600 font-sans my-0;
}
.markdown-viewer .toc a {
  @apply text-indigo-600 font-normal no-underline hover:underline;
}
.markdown-viewer .toc li    { @apply m-0; }
.markdown-viewer .toc ul ul { @apply pl-4; }

/* Notebook Spacing */
/* --------------------------------------------------------------- */

.notebook-viewer { @apply py-16; }
#clerk-static-app .notebook-viewer { @apply pt-[0.8rem] pb-16; }
.markdown-viewer *:first-child:not(.code-viewer):not(li):not(h2):not(.sidenote) { @apply mt-0; }
/*.viewer + .viewer { @apply mt-6; }*/
.viewer + .result-viewer { @apply mt-0; }
.code-viewer + .result-viewer { @apply mt-3; }
.markdown-viewer + .markdown-viewer { @apply mt-0; }

/* Sidenotes */
/* --------------------------------------------------------------- */

.sidenote-ref {
  @apply top-[-0.5em] w-auto h-auto inline border-0 bg-transparent m-0 pointer-events-none;
}
.sidenote {
  @apply block font-sans text-xs mt-4 bg-slate-100 dark:bg-slate-800 p-4;
  font-style: normal;
  font-weight: normal;
}
.sidenote-container {
  @apply mb-4;
}
@media (min-width: 860px) {
  .sidenote sup { @apply inline; }
  .sidenote-column {
    @apply w-[165px] absolute right-0 top-0 -mr-[205px];
  }
  .sidenote {
    @apply bg-transparent dark:bg-transparent p-0;
  }
  .sidenote:first-child {
    @apply mt-1;
  }
  .sidenotes-layout .markdown-viewer {
    @apply pr-[241px];
  }
  .sidenote-container {
    @apply relative mb-0;
  }
  .sidenotes-layout h1 {
    @apply w-[756px] !important;
  }
}
.code-viewer + .viewer:not(.code-viewer):not(.code-viewer-folded),
.code-viewer-folded + .viewer:not(.code-viewer):not(.code-viewer-folded),
.result-viewer:not(.markdown-node-viewer) + .result-viewer {
  @apply mt-2;
}
.code-viewer + .code-viewer-folded {
  @apply mt-4;
}
.result-viewer {
  @apply leading-tight mb-6;
}
.code-viewer.fragment-item.result-viewer {
  @apply mb-0 !important;
}
.result-viewer figure {
  @apply mt-0 !important;
}
@media (min-width: 768px) {
  .devcard-desc > div {
    @apply max-w-full m-0;
  }
}

/* Command Palette */
/* --------------------------------------------------------------- */

.nj-commands-input {
  @apply bg-transparent text-white;
}
.nj-context-menu-item:hover:not([disabled]) {
  @apply cursor-pointer;
  background-color: rgba(255,255,255,.14);
}

/* Devdocs */
/* --------------------------------------------------------------- */

.logo, .logo-white {
  @apply block indent-[-999em];
  background: url(/images/nextjournal-logo.svg) center center no-repeat;
}
.devdocs-body {
  @apply font-inter;
}

/* Workarounds */
/* --------------------------------------------------------------- */

/* Fixes vega viewer resizing into infinity */
.vega-embed .chart-wrapper { @apply h-auto !important; }
/* fixes fraction separators being overridden by tw’s border-color */
.katex * { @apply border-black; }

@media print {
    .dark-mode-toggle,
    .toc-toggle { @apply hidden; }
    .notebook-viewer { @apply pt-0; font-size: 12pt !important; margin-left: 0 !important; }
    .code-viewer .cm-content,
    .viewer-code .cm-content { @apply whitespace-pre-wrap !important; overflow: none; }
    .code-viewer .cm-line { font-size: 12pt !important; }
    html * { page-break-inside: avoid !important; }
    .toc-panel { @apply hidden; }
}
</style><script src="https://storage.clerk.garden/nextjournal/clerk-assets@4NdW4yYfmUzzw9xCkmyrJ75nH75d/viewer.js?immutable=true" type="module"></script><link href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.bunny.net" rel="preconnect"><link href="https://fonts.bunny.net/css?family=fira-mono:400,700%7Cfira-sans:400,400i,500,500i,700,700i%7Cfira-sans-condensed:700,700i%7Cpt-serif:400,400i,700,700i" rel="stylesheet" type="text/css"></head><body><div id="clerk-static-app"></div><script type="module">let state = "{:out-path \"public/build\", :path->doc {\"src/emmy/pattern/match.cljc\" {:path [], :nextjournal/value {:toc {:type :toc, :children [{:type :toc, :content [{:type :text, :text \"Emmy Pattern Matching\"}], :heading-level 1, :attrs {:id \"emmy-pattern-matching\"}, :path [:content 0], :children [{:children [{:type :toc, :content [{:type :text, :text \"Matcher Combinators\"}], :heading-level 3, :attrs {:id \"matcher-combinators\"}, :path [:content 2]} {:type :toc, :content [{:type :text, :text \"Matcher\"}], :heading-level 3, :attrs {:id \"matcher\"}, :path [:content 6]} {:type :toc, :content [{:type :text, :text \"Consequence Functions\"}], :heading-level 3, :attrs {:id \"consequence-functions\"}, :path [:content 9]} {:type :toc, :content [{:type :text, :text \"Rule\"}], :heading-level 3, :attrs {:id \"rule\"}, :path [:content 11]}], :type :toc} {:type :toc, :content [{:type :text, :text \"Combinators\"}], :heading-level 2, :attrs {:id \"combinators\"}, :path [:content 16], :children [{:type :toc, :content [{:type :text, :text \"Basic Matcher Combinators\"}], :heading-level 3, :attrs {:id \"basic-matcher-combinators\"}, :path [:content 20]} {:type :toc, :content [{:type :text, :text \"Matcher Combinators\"}], :heading-level 3, :attrs {:id \"matcher-combinators-2\"}, :path [:content 21]} {:type :toc, :content [{:type :text, :text \"Lists and Segments\"}], :heading-level 3, :attrs {:id \"lists-and-segments\"}, :path [:content 25]}]} {:type :toc, :content [{:type :text, :text \"Emmy.Pattern.Matching Compiler\"}], :heading-level 2, :attrs {:id \"emmy.pattern.matching-compiler\"}, :path [:content 31]} {:type :toc, :content [{:type :text, :text \"Top Level Matchers\"}], :heading-level 2, :attrs {:id \"top-level-matchers\"}, :path [:content 34]}]}]}, :sidenotes? false, :toc-visibility true, :atom-var-name->state #viewer-eval (nextjournal.clerk.render/intern-atoms! {}), :ns #viewer-eval (ns emmy.pattern.match), :auto-expand-results? nil, :scope emmy.pattern.match, :bundle? false, :open-graph {:type \"article:clerk\", :title \"Emmy Pattern Matching\", :description \"The library is built out of a few stacked ideas: matcher combinators, matchers, consequences and rules.\"}, :title \"Emmy Pattern Matching\", :blocks [{:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"emmy.pattern.match/markdown-5dsccKWUEdY2cQh8xfK3AZNEbTGW5S\"} [\"h1\" {:id \"emmy-pattern-matching\"} [:<> \"Emmy Pattern Matching\"]] [:p [:<> \"The library is built out of a few stacked ideas: matcher combinators,\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"matchers, consequences and rules.\"]] [\"h3\" {:id \"matcher-combinators\"} [:<> \"Matcher Combinators\"]] [:ul [:li [:<> [:<> \"A \\\"matcher combinator\\\" is a function that takes three arguments:\"]]]] [:p [:code [:<> \"[binding-frame data success-continuation]\"]]] [:p [:<> \"and either returns \"] [:code [:<> \"nil\"]] [:<> \" or \"] [:code [:<> \"false\"]] [:<> \", or calls its \"] [:code [:<> \"success-continuation\"]] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"with a potentially-updated binding map.\"]] [\"h3\" {:id \"matcher\"} [:<> \"Matcher\"]] [:p [:<> \"A \"] [:code [:<> \"matcher\"]] [:<> \" is a function of a \"] [:code [:<> \"data\"]] [:<> \" input that can succeed or fail. If it\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"succeeds, it will return the binding map generated by the matching process.\"]] [:p [:<> \"On failure, a matcher returns a special \"] [:code [:<> \"failure\"]] [:<> \" singleton object. You can\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"check for this object using [[fail?]].\"]] [\"h3\" {:id \"consequence-functions\"} [:<> \"Consequence Functions\"]] [:p [:<> \"A consequence is a function from the binding map returned by a matcher to a\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"final form. A consequence can fail by returning \"] [:code [:<> \"false\"]] [:<> \", \"] [:code [:<> \"nil\"]] [:<> \" or the special\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:code [:<> \"failure\"]] [:<> \" singleton.\"]] [\"h3\" {:id \"rule\"} [:<> \"Rule\"]] [:p [:<> \"A rule is a function of \"] [:code [:<> \"data\"]] [:<> \" built from a pair of:\"]] [:ul [:li [:<> [:<> \"a matcher\"]]] [:li [:<> [:<> \"a consequence function.\"]]]] [:p [:<> \"If the matcher fails on the rule's input, the whole rule returns \"] [:code [:<> \"failure\"]] [:<> \".\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"If the match succeeds, the rule calls the consequence function with the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"matcher's binding map. If THIS function succeeds, the rule returns that\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"value.\"]] [:p [:<> \"If the consequence function returns \"] [:code [:<> \"nil\"]] [:<> \" or \"] [:code [:<> \"false\"]] [:<> \" (or \"] [:code [:<> \"failure\"]] [:<> \"), the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"whole \"] [:code [:<> \"rule\"]] [:<> \" fails with \"] [:code [:<> \"failure\"]] [:<> \".\"]] [\"h2\" {:id \"combinators\"} [:<> \"Combinators\"]] [:p [:code [:<> \"emmy.pattern.match\"]] [:<> \" contains many matcher combinators. These are either functions\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"with the contract described above, or functions that take one or more\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"combinators and return a new combinator with the same contract. Examples\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"are [[or]], [[not]], [[and]], [[match-when]] and more below.\"]] [:p [:code [:<> \"emmy.pattern.rule\"]] [:<> \" contains many rule combinators, which are either primitive\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"rules or functions from zero or more rules to a new rule.\"]] [:p [:<> \"Finally, \"] [:code [:<> \"emmy.pattern.syntax\"]] [:<> \" defines a small pattern language. Any matcher\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"combinator that take another matcher can take a pattern instead.\"]] [\"h3\" {:id \"basic-matcher-combinators\"} [:<> \"Basic Matcher Combinators\"]]], :nextjournal/opts {:id \"emmy.pattern.match/markdown-5dsccKWUEdY2cQh8xfK3AZNEbTGW5S\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-with-react-key, :hash \"5drtFhRgc8WMLrXw6DB4bZLsNZjHHp\"}} {:path [], :nextjournal/value \"(defn fail\\n  \\\"Matcher which will fail for any input.\\\"\\n  [_ _ _])\", :nextjournal/opts {:id \"emmy.pattern.match/fail-code\", :loc {:line 80, :end-line 82, :column 1, :end-column 11}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$fail 0x5ffe11a4 \\\"emmy.pattern.match$fail@5ffe11a4\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/fail-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/fail-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn pass\\n  \\\"Matcher that succeeds (with no new bindings) for any input, passing along its\\n  input frame.\\\"\\n  [frame _ succeed]\\n  (succeed frame))\", :nextjournal/opts {:id \"emmy.pattern.match/pass-code\", :loc {:line 84, :end-line 88, :column 1, :end-column 19}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$pass 0x4a10d608 \\\"emmy.pattern.match$pass@4a10d608\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/pass-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/pass-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn with-frame\\n  \\\"Takes a `new-frame` of bindings and returns a matcher that will ignore its\\n  input and always succeed by replacing the current map of bindings with\\n  `new-frame`.\\\"\\n  [new-frame]\\n  (fn [_ _ succeed]\\n    (succeed new-frame)))\", :nextjournal/opts {:id \"emmy.pattern.match/with-frame-code\", :loc {:line 90, :end-line 96, :column 1, :end-column 26}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$with_frame 0x4a519a9b \\\"emmy.pattern.match$with_frame@4a519a9b\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/with-frame-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/with-frame-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn update-frame\\n  \\\"Takes a function from `frame` to a new frame (or false) and any number of\\n  arguments `args`, and returns a matcher that will ignore its input and\\n\\n  - succeed with `(apply f frame args)` if that value is truthy,\\n  - fail otherwise.\\\"\\n  [f & args]\\n  (fn [frame _ succeed]\\n    (when-let [new-frame (apply f frame args)]\\n      (succeed new-frame))))\", :nextjournal/opts {:id \"emmy.pattern.match/update-frame-code\", :loc {:line 98, :end-line 107, :column 1, :end-column 29}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$update_frame 0x3058804a \\\"emmy.pattern.match$update_frame@3058804a\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/update-frame-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/update-frame-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn predicate\\n  \\\"Takes a predicate function `pred` and returns a matcher that succeeds (with no\\n  new bindings) if its data input passes the predicate, fails otherwise.\\\"\\n  [pred]\\n  (fn predicate-match [frame data succeed]\\n    (core/and (pred data)\\n              (succeed frame))))\", :nextjournal/opts {:id \"emmy.pattern.match/predicate-code\", :loc {:line 109, :end-line 115, :column 1, :end-column 33}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$predicate 0x1f04c4d4 \\\"emmy.pattern.match$predicate@1f04c4d4\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/predicate-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/predicate-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn frame-predicate\\n  \\\"Takes a predicate function `pred` and returns a matcher that succeeds (with no\\n  new bindings) if its data input passes the predicate, fails otherwise.\\\"\\n  [pred]\\n  (fn frame-pred [frame _ succeed]\\n    (core/and (pred frame)\\n              (succeed frame))))\", :nextjournal/opts {:id \"emmy.pattern.match/frame-predicate-code\", :loc {:line 117, :end-line 123, :column 1, :end-column 33}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$frame_predicate 0x53e8f1aa \\\"emmy.pattern.match$frame_predicate@53e8f1aa\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/frame-predicate-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/frame-predicate-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn eq\\n  \\\"Takes some input `x` and returns a matcher which succeeds if its data input is\\n  equal to `x` (via `=` or the optional `eq-fn` argument). Fails otherwise.\\n\\n  The frame is not modified.\\\"\\n  ([x] (eq x =))\\n  ([x eq-fn]\\n   (predicate\\n    (fn [other]\\n      (eq-fn x other)))))\", :nextjournal/opts {:id \"emmy.pattern.match/eq-code\", :loc {:line 125, :end-line 134, :column 1, :end-column 26}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$eq 0x15ab3c0e \\\"emmy.pattern.match$eq@15ab3c0e\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/eq-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/eq-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn bind\\n  \\\"Takes a binding variable `sym` and an optional predicate `pred`, and returns a\\n  matcher that binds its input to `sym` in the returned `frame`.\\n\\n  The returned matcher only succeeds if `input` passes `pred`.\\n\\n  If `sym` is already present in `frame`, the matcher only succeeds if the\\n  values are equal, fails otherwise.\\n\\n  NOTE: If `sym` is the wildcard `_`, the returned matcher will not introduce a\\n  new binding, but _will_ still check the predicate.\\\"\\n  ([sym]\\n   (bind sym (fn [_] true)))\\n  ([sym pred]\\n   (if (s/wildcard? sym)\\n     (predicate pred)\\n     (fn bind-match [frame data succeed]\\n       (when (pred data)\\n         (if-let [[_ binding] (find frame sym)]\\n           (core/and (= binding data)\\n                     (succeed frame))\\n           (succeed (assoc frame sym data))))))))\", :nextjournal/opts {:id \"emmy.pattern.match/bind-code\", :loc {:line 136, :end-line 157, :column 1, :end-column 50}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$bind 0x6105a421 \\\"emmy.pattern.match$bind@6105a421\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/bind-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/bind-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"emmy.pattern.match/markdown-5dsbwu2yyK4ns4dAGshyzvcFTk4Lx8\"} [\"h3\" {:id \"matcher-combinators-2\"} [:<> \"Matcher Combinators\"]] [:p [:<> \"This section introduces functions that are able to build new matcher\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"combinators out of the primitive matcher combinators defined above.\"]] [:p [:<> \"Each of the following functions can take EITHER a matcher combinator or\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"a \\\"pattern\\\". The emmy.pattern.syntax is described in \"] [:code [:<> \"emmy.pattern.syntax\"]] [:<> \".\"]] [:p [:<> \"As an example, you might provide the symbol \"] [:code [:<> \"'?x\"]] [:<> \" instead of an\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"explicit \"] [:code [:<> \"(bind '?x)\"]] [:<> \":\"]]], :nextjournal/opts {:id \"emmy.pattern.match/markdown-5dsbwu2yyK4ns4dAGshyzvcFTk4Lx8\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-with-react-key, :hash \"5drtFhRgc8WMLrXw6DB4bZLsNZjHHp\"}} {:path [], :nextjournal/value \"(comment\\n  (let [m (match-if odd? '?odd '?even)]\\n    (= [{'?odd 11} {'?even 12}]\\n       [(m {} 11 identity)\\n        (m {} 12 identity)])))\", :nextjournal/opts {:id \"emmy.pattern.match/anon-expr-5dtpvkDqP5RE6xULfTkD6tKFphbdQr-code\", :loc {:line 170, :end-line 174, :column 1, :end-column 31}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value nil, :nextjournal/opts {:id \"emmy.pattern.match/anon-expr-5dtpvkDqP5RE6xULfTkD6tKFphbdQr-result\"}, :nextjournal/viewer {:render-fn #viewer-fn (fn [_] [:span.cmt-default.inspected-value \"nil\"]), :hash \"5dtUvzjkkSGDKH896hrVHyYFWTpQG6\"}}, :nextjournal/blob-id \"5dt85x6ZMsE84yEGFVFTR1qC6S94of\"}, :nextjournal/opts {:id \"emmy.pattern.match/anon-expr-5dtpvkDqP5RE6xULfTkD6tKFphbdQr-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(declare pattern->combinators)\", :nextjournal/opts {:id \"emmy.pattern.match/anon-expr-5dshacpbrmirXNVKioDhaCoZjSk2SA-code\", :loc {:line 176, :end-line 176, :column 1, :end-column 31}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$pattern__GT_combinators 0x581eeeb1 \\\"emmy.pattern.match$pattern__GT_combinators@581eeeb1\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/anon-expr-5dshacpbrmirXNVKioDhaCoZjSk2SA-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/anon-expr-5dshacpbrmirXNVKioDhaCoZjSk2SA-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn match-when\\n  \\\"Returns a matcher that passes its `frame` on to `success-pattern` if `pred`\\n  succeeds on its data input, fails otherwise.\\\"\\n  [pred success-pattern]\\n  (let [match (pattern->combinators success-pattern)]\\n    (fn [frame xs success]\\n      (when (pred xs)\\n        (match frame xs success)))))\", :nextjournal/opts {:id \"emmy.pattern.match/match-when-code\", :loc {:line 178, :end-line 185, :column 1, :end-column 37}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$match_when 0x4c6f21b9 \\\"emmy.pattern.match$match_when@4c6f21b9\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/match-when-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/match-when-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn match-if\\n  \\\"Returns a matcher that passes its `frame` on to `success-pattern` if `pred`\\n  succeeds on its data input, `fail-pattern` otherwise.\\n\\n  If no `fail-matcher` is supplied, the behavior is equivalent\\n  to [[match-when]].\\\"\\n  ([pred success-pattern]\\n   (match-when pred success-pattern))\\n  ([pred success-pattern fail-pattern]\\n   (let [s-match (pattern->combinators success-pattern)\\n         f-match (pattern->combinators fail-pattern)]\\n     (fn [frame xs success]\\n       (if (pred xs)\\n         (s-match frame xs success)\\n         (f-match frame xs success))))))\", :nextjournal/opts {:id \"emmy.pattern.match/match-if-code\", :loc {:line 187, :end-line 201, :column 1, :end-column 41}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$match_if 0xe82f76 \\\"emmy.pattern.match$match_if@e82f76\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/match-if-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/match-if-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn or\\n  \\\"Takes a sequence of patterns, and returns a matcher that will apply its\\n  arguments to each matcher in turn. Returns the value of the first pattern that\\n  succeeds.\\\"\\n  ([] fail)\\n  ([pattern] (pattern->combinators pattern))\\n  ([pattern & more]\\n   (let [matchers (map pattern->combinators (cons pattern more))]\\n     (fn call [frame xs succeed]\\n       (some #(% frame xs succeed)\\n             matchers)))))\", :nextjournal/opts {:id \"emmy.pattern.match/or-code\", :loc {:line 203, :end-line 213, :column 1, :end-column 27}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$or 0x4c80b7e6 \\\"emmy.pattern.match$or@4c80b7e6\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/or-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/or-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn and\\n  \\\"Takes a sequence of patterns and returns a matcher that will apply its\\n  arguments to the first pattern;\\n\\n  If that match succeeds, the next pattern will be called with the new, returned\\n  frame (and the original data and success continuation).\\n\\n  The returned matcher succeeds only of all patterns succeed, and returns the\\n  value of the final pattern.\\\"\\n  ([] pass)\\n  ([pattern] (pattern->combinators pattern))\\n  ([pattern & more]\\n   (let [matchers (map pattern->combinators (cons pattern more))]\\n     (fn [frame xs succeed]\\n       (reduce (fn [acc matcher]\\n                 (if acc\\n                   (matcher acc xs succeed)\\n                   (reduced acc)))\\n               frame\\n               matchers)))))\", :nextjournal/opts {:id \"emmy.pattern.match/and-code\", :loc {:line 215, :end-line 234, :column 1, :end-column 29}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$and 0x6344a3a1 \\\"emmy.pattern.match$and@6344a3a1\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/and-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/and-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn not\\n  \\\"Takes a `pattern` and returns a matcher that will apply its arguments to the\\n  `pattern`. The returned pattern will succeed with the original frame if\\n  `pattern` fails, and fail if `pattern` succeeds.\\\"\\n  [pattern]\\n  (let [match (pattern->combinators pattern)]\\n    (fn [frame xs succeed]\\n      (when-not (match frame xs succeed)\\n        (succeed frame)))))\", :nextjournal/opts {:id \"emmy.pattern.match/not-code\", :loc {:line 236, :end-line 244, :column 1, :end-column 28}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$not 0x56132499 \\\"emmy.pattern.match$not@56132499\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/not-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/not-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"emmy.pattern.match/markdown-5dsaAKfhS5JK7prKhRTWpL8FLQvn3w\"} [\"h3\" {:id \"lists-and-segments\"} [:<> \"Lists and Segments\"]] [:p [:<> \"Segment variables introduce some additional trouble. Unlike other matchers, a\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"segment variable is not tested against a fixed input, but against a sequence\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"such that it may match any prefix. This means that in general, segment\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"variables must search, trying one match and possibly backtracking.\"]] [:p [:<> \"There are two circumstances when the search can be avoided:\"]] [:ul [:li [:p [:<> \"if the variable is already bound, the bound value needs to be checked\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"against the input data, and will either fail or succeed.\"]]] [:li [:p [:<> \"If the segment variable is the last matcher in its enclosing list (which\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"actually happens quite often!) then the segment matcher can match the\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"entire remaining segment, no search required.\"]]]] [:p [:<> \"This requires a different interface for the continutation. Segment matchers\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"pass TWO arguments into their success continuation - the binding frame, and\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"the remaining unmatched segment.\"]] [:p [:<> \"The following two functions let us mark matcher combinators with this\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"interface using their metadata.\"]]], :nextjournal/opts {:id \"emmy.pattern.match/markdown-5dsaAKfhS5JK7prKhRTWpL8FLQvn3w\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-with-react-key, :hash \"5drtFhRgc8WMLrXw6DB4bZLsNZjHHp\"}} {:path [], :nextjournal/value \"(defn as-segment-matcher\\n  \\\"Takes a matcher and returns `f` with its metadata modified such\\n  that [[segment-matcher?]] will return `true` when applied to `f`.\\\"\\n  [f]\\n  (vary-meta f assoc ::segment? true))\", :nextjournal/opts {:id \"emmy.pattern.match/as-segment-matcher-code\", :loc {:line 269, :end-line 273, :column 1, :end-column 39}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$as_segment_matcher 0x174122b2 \\\"emmy.pattern.match$as_segment_matcher@174122b2\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/as-segment-matcher-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/as-segment-matcher-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn- segment-matcher?\\n  \\\"Returns true if the supplied matcher `f` is a segment matcher, false\\n  otherwise.\\\"\\n  [f]\\n  (::segment? (meta f) false))\", :nextjournal/opts {:id \"emmy.pattern.match/segment-matcher?-code\", :loc {:line 275, :end-line 279, :column 1, :end-column 31}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$segment_matcher_QMARK_ 0x5eb7883b \\\"emmy.pattern.match$segment_matcher_QMARK_@5eb7883b\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/segment-matcher?-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/segment-matcher?-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn segment\\n  \\\"Takes a binding variable `sym` and returns a matcher that calls its success\\n  continuation with successively longer prefixes of its (sequential) data input\\n  bound to `sym` inside the frame.\\n\\n  If `sym` is already present in the frame, the returned matcher only succeeds\\n  if the bound value is a prefix of the data argument `xs`.\\n\\n  If `sym` matches the wildcard symbol `_`, the behavior is the same, but no new\\n  binding is introduced.\\n\\n  NOTE: the returned matcher will call its success continuation with TWO\\n  arguments; the new frame and the remaining elements in `xs`. This is a\\n  different contract than all other matchers, making `segment` appropriate for\\n  use inside `sequence`.\\\"\\n  ([sym]\\n   (segment sym (constantly true)))\\n  ([sym pred]\\n   (as-segment-matcher\\n    (fn segment-match [frame xs succeed]\\n      (let [xs (core/or xs [])]\\n        (when (sequential? xs)\\n          (if-let [binding (core/and\\n                            (core/not (s/wildcard? sym))\\n                            (frame sym))]\\n            (when (pred binding)\\n              (let [binding-count (count binding)]\\n                (when (= (take binding-count xs) binding)\\n                  (succeed frame (drop binding-count xs)))))\\n            (loop [prefix []\\n                   suffix xs]\\n              (core/or\\n               (core/and (pred prefix)\\n                         (let [new-frame (if (s/wildcard? sym)\\n                                           frame\\n                                           (assoc frame sym prefix))]\\n                           (succeed new-frame suffix)))\\n               (core/and (seq suffix)\\n                         (recur (conj prefix (first suffix))\\n                                (next suffix))))))))))))\", :nextjournal/opts {:id \"emmy.pattern.match/segment-code\", :loc {:line 281, :end-line 320, :column 1, :end-column 57}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$segment 0x18a871e7 \\\"emmy.pattern.match$segment@18a871e7\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/segment-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/segment-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn- entire-segment\\n  \\\"Similar to [[segment]], but matches the entire remaining sequential argument\\n  `xs`. Fails if its input is not sequential, or `sym` is already bound to some\\n  other variable or non-equal sequence.\\n\\n  If `sym` matches the wildcard symbol `_`, succeeds if `xs` is a sequence and\\n  introduces NO new bindings.\\n\\n  Calls its continuation with the new frame and `nil`, always.\\\"\\n  ([sym]\\n   (entire-segment sym (constantly true)))\\n  ([sym pred]\\n   (as-segment-matcher\\n    (fn entire-segment-match [frame xs succeed]\\n      (let [xs (core/or xs [])]\\n        (when (core/and (sequential? xs) (pred xs))\\n          (if (s/wildcard? sym)\\n            (succeed frame nil)\\n            (if-let [binding (frame sym)]\\n              (when (= xs binding)\\n                (succeed frame nil))\\n              (succeed (assoc frame sym xs) nil)))))))))\", :nextjournal/opts {:id \"emmy.pattern.match/entire-segment-code\", :loc {:line 322, :end-line 343, :column 1, :end-column 57}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$entire_segment 0x5750a987 \\\"emmy.pattern.match$entire_segment@5750a987\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/entire-segment-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/entire-segment-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn reverse-segment\\n  \\\"Returns a matcher that takes a binding variable `sym`, and succeeds if it's\\n  called with a sequential data argument with a prefix that is the REVERSE of\\n  the sequence bound to `sym` in `frame`.\\n\\n  Fails if any of the following are true:\\n\\n  - `sym` is not bound in the frame\\n  - `sym` is bound to something other than a vector prefix created by `segment`\\n  - the data argument does not have a prefix matching the reverse of vector\\n    bound to `sym`.\\\"\\n  ([sym]\\n   (reverse-segment sym (constantly true)))\\n  ([sym pred]\\n   (as-segment-matcher\\n    (fn reverse-segment-match [frame xs succeed]\\n      (let [xs (core/or xs [])]\\n        (when (sequential? xs)\\n          (when-let [binding (frame sym)]\\n            (when (vector? binding)\\n              (let [binding-count (count binding)\\n                    reversed      (rseq binding)]\\n                (when (core/and (= (take binding-count xs) reversed)\\n                                (pred xs))\\n                  (succeed frame (drop binding-count xs))))))))))))\", :nextjournal/opts {:id \"emmy.pattern.match/reverse-segment-code\", :loc {:line 345, :end-line 369, :column 1, :end-column 68}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$reverse_segment 0x499a556d \\\"emmy.pattern.match$reverse_segment@499a556d\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/reverse-segment-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/reverse-segment-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn sequence*\\n  \\\"Version of [[sequence]] that takes an explicit sequence of `patterns`, vs the\\n  multi-arity version. See [[sequence]] for documentation.\\\"\\n  [patterns]\\n  (fn sequence-match [frame xs succeed]\\n    (when (sequential? xs)\\n      (letfn [(step [frame items matchers]\\n                (letfn [(try-elem [matcher]\\n                          (matcher frame\\n                                   (first items)\\n                                   (fn [new-frame]\\n                                     (step new-frame\\n                                           (next items)\\n                                           (next matchers)))))\\n\\n                        (try-segment [matcher]\\n                          (matcher frame\\n                                   items\\n                                   (fn [new-frame new-xs]\\n                                     (step new-frame\\n                                           new-xs\\n                                           (next matchers)))))]\\n                  (cond matchers (let [m (first matchers)]\\n                                   (if (segment-matcher? m)\\n                                     (try-segment m)\\n                                     (core/and (seq items)\\n                                               (try-elem m))))\\n\\n                        (seq items) false\\n                        :else (succeed frame))))]\\n        (let [matchers (map pattern->combinators patterns)]\\n          (step frame xs matchers))))))\", :nextjournal/opts {:id \"emmy.pattern.match/sequence*-code\", :loc {:line 371, :end-line 402, :column 1, :end-column 40}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$sequence_STAR_ 0x2b8efa35 \\\"emmy.pattern.match$sequence_STAR_@2b8efa35\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/sequence*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/sequence*-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn sequence\\n  \\\"Takes a sequence of patterns and returns a matcher that accepts a sequential\\n  data input, and attempts to match successive items (or segments) in the\\n  sequence with the supplied patterns.\\n\\n  The returned matcher succeeds if `patterns` can consume all elements, fails\\n  otherwise (or of any of the supplied patterns fails on its argument).\\n\\n  On success, the returned matcher calls its success continuation with a frame\\n  processed by each pattern in sequence.\\\"\\n  [& patterns]\\n  (sequence* patterns))\", :nextjournal/opts {:id \"emmy.pattern.match/sequence-code\", :loc {:line 404, :end-line 415, :column 1, :end-column 24}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$sequence 0x70f281ea \\\"emmy.pattern.match$sequence@70f281ea\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/sequence-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/sequence-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"emmy.pattern.match/markdown-5du49Be6KLj8fbpZLHzJrhTiMR5vSM\"} [\"h2\" {:id \"emmy.pattern.matching-compiler\"} [:<> \"Emmy.Pattern.Matching Compiler\"]] [:p [:<> \"The next function transforms a pattern (as defined by \"] [:code [:<> \"emmy.pattern.syntax\"]] [:<> \") into\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"a matcher combinator. Any function you pass to [[pattern->combinators]] is\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"returned, so it's appropriate to pass other matcher combinators as pattern\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"elements.\"]]], :nextjournal/opts {:id \"emmy.pattern.match/markdown-5du49Be6KLj8fbpZLHzJrhTiMR5vSM\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-with-react-key, :hash \"5drtFhRgc8WMLrXw6DB4bZLsNZjHHp\"}} {:path [], :nextjournal/value \"(defn pattern->combinators\\n  \\\"Given a pattern (built using the syntax elements described in\\n  `emmy.pattern.syntax`), returns a matcher combinator that will successfully\\n  match data structures described by the input pattern, and fail otherwise.\\\"\\n  [pattern]\\n  (cond (fn? pattern) pattern\\n\\n        (s/binding? pattern)\\n        (bind (s/variable-name pattern)\\n              (s/restriction pattern))\\n\\n        (s/segment? pattern)\\n        (segment\\n         (s/variable-name pattern)\\n         (s/restriction pattern))\\n\\n        (s/reverse-segment? pattern)\\n        (reverse-segment\\n         (s/reverse-segment-name pattern)\\n         (s/restriction pattern))\\n\\n        (s/wildcard? pattern) pass\\n\\n        (core/or (seq? pattern)\\n                 (vector? pattern))\\n        (if (empty? pattern)\\n          (eq pattern)\\n          (sequence*\\n           (concat (map pattern->combinators (butlast pattern))\\n                   (let [p (last pattern)]\\n                     [(if (s/segment? p)\\n                        (entire-segment\\n                         (s/variable-name p)\\n                         (s/restriction p))\\n                        (pattern->combinators p))]))))\\n\\n        :else (eq pattern)))\", :nextjournal/opts {:id \"emmy.pattern.match/pattern->combinators-code\", :loc {:line 424, :end-line 460, :column 1, :end-column 29}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$pattern__GT_combinators 0x581eeeb1 \\\"emmy.pattern.match$pattern__GT_combinators@581eeeb1\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/pattern->combinators-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/pattern->combinators-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"emmy.pattern.match/markdown-5drLhnM7D86iufYCUSwXZo5fC44Hha\"} [:p [:<> \"This concludes the matcher combinator section of our program. On to the next\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"act: the \\\"matcher\\\"!\"]] [\"h2\" {:id \"top-level-matchers\"} [:<> \"Top Level Matchers\"]] [:p [:<> \"Once you've built up a combinator out of smaller matcher combinators, you can\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"turn your combinator into a \\\"matcher\\\". This is a function from a data object\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"to either:\"]] [:ul [:li [:<> [:<> \"the binding map, if successful\"]]] [:li [:<> [:<> \"if failed, a special \"] [:code [:<> \"failure\"]] [:<> \" singleton object.\"]]]] [:p [:<> \"This interface will become important in \"] [:code [:<> \"emmy.rule\"]] [:<> \", for building up\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"groups of rules that can, say, search for the first successful matcher of\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"many, or accumulate binding maps from matchers run in sequence until one\"] [#viewer-eval nextjournal.clerk.render/inspect-presented {:nextjournal/value [:<> \" \"], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn identity, :hash \"5du5eveS8XMqMDMYH5rpQ1bqryEJdg\"}}] [:<> \"fails.\"]] [:p [:<> \"The next few functions define this explicit \"] [:code [:<> \"failure\"]] [:<> \" singleton.\"]]], :nextjournal/opts {:id \"emmy.pattern.match/markdown-5drLhnM7D86iufYCUSwXZo5fC44Hha\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-with-react-key, :hash \"5drtFhRgc8WMLrXw6DB4bZLsNZjHHp\"}} {:path [], :nextjournal/value \"(defrecord Failure [])\", :nextjournal/opts {:id \"emmy.pattern.match/anon-expr-5drX6iaZUrdshDX16tKSXopQwx5pBQ-code\", :loc {:line 482, :end-line 482, :column 1, :end-column 23}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"emmy.pattern.match.Failure\", :nextjournal/opts {:id \"emmy.pattern.match/anon-expr-5drX6iaZUrdshDX16tKSXopQwx5pBQ-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id \"5drFjhpEpdWH6cmQV5QGs3xb8E9spD\"}, :nextjournal/opts {:id \"emmy.pattern.match/anon-expr-5drX6iaZUrdshDX16tKSXopQwx5pBQ-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(def failure\\n  \\\"Singleton object representing the failure of a matcher to match its input.\\n  Check for failure with [[failed?]]\\\"\\n  (Failure.))\", :nextjournal/opts {:id \"emmy.pattern.match/failure-code\", :loc {:line 484, :end-line 487, :column 1, :end-column 14}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value [], :nextjournal/opts {:id \"emmy.pattern.match/failure-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/map-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-map, :opening-paren \"{\", :closing-paren (\"}\"), :page-size 10, :hash \"5drc3ac5ux7kS4h2vozdxwsrKDqSmn\"}}, :nextjournal/blob-id \"5dsUY5Nfm4rAnHfuFysZZWLg3vnXpR\"}, :nextjournal/opts {:id \"emmy.pattern.match/failure-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn failed?\\n  \\\"Returns true if `x` is equivalent to the failure sentinel [[failure]], false\\n  otherwise.\\\"\\n  [x]\\n  (instance? Failure x))\", :nextjournal/opts {:id \"emmy.pattern.match/failed?-code\", :loc {:line 489, :end-line 493, :column 1, :end-column 25}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$failed_QMARK_ 0x22bc12e2 \\\"emmy.pattern.match$failed_QMARK_@22bc12e2\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/failed?-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/failed?-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn matcher\\n  \\\"Takes a `pattern` or matcher combinator, and returns a function from a data\\n  object to either:\\n\\n  - A successful map of bindings extracted by matching the supplied `pattern` or\\n    combinator to the input data\\n  - An explicit `failure` object\\n\\n  Check for failure with [[failed?]].\\n\\n  Optionally, you can supply a predicate `pred`. `pred` takes the map of\\n  bindings from a successful match and returns either:\\n\\n  - `nil`, `false` or the explicit `failure` object to force a match failure,\\n    potentially causing a backtrack back into the data\\n  - a map of NEW bindings to merge into the binding map (and signal success)\\n\\n  Any other truthy value signals success with no new bindings.\\\"\\n  ([pattern]\\n   (let [match (pattern->combinators pattern)]\\n     (fn [data]\\n       (core/or (match {} data identity)\\n                failure))))\\n  ([pattern pred]\\n   (let [match (pattern->combinators pattern)\\n         success (fn [frame]\\n                   (when-let [m (pred frame)]\\n                     (when (core/and m (not (failed? m)))\\n                       (if (map? m)\\n                         (merge frame m)\\n                         frame))))]\\n     (fn [data]\\n       (core/or (match {} data success)\\n                failure)))))\", :nextjournal/opts {:id \"emmy.pattern.match/matcher-code\", :loc {:line 495, :end-line 528, :column 1, :end-column 29}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$matcher 0x39160ae5 \\\"emmy.pattern.match$matcher@39160ae5\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/matcher-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/matcher-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn match\\n  \\\"Convenience function that creates a matcher from the supplied `pattern` (and\\n  optional predicate `pred`) and immediately applies it to `data`.\\n\\n  Equivalent to:\\n\\n  ```clojure\\n  ((matcher pattern pred) data)\\n  ```\\\"\\n  ([pattern data]\\n   ((matcher pattern) data))\\n  ([pattern pred data]\\n   ((matcher pattern pred) data)))\", :nextjournal/opts {:id \"emmy.pattern.match/match-code\", :loc {:line 530, :end-line 542, :column 1, :end-column 35}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$match 0x659500a0 \\\"emmy.pattern.match$match@659500a0\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/match-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/match-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn foreach-matcher\\n  \\\"Takes a `pattern` and side-effecting callback function `f`, and returns a\\n  matcher that calls `f` with a map of bindings for every possible match of\\n  `pattern` to its input data.\\n\\n  For a convenience function that applies the matcher to data immediately,\\n  see [[foreach]].\\n\\n  NOTE: If you pass a segment matcher, `f` must accept two arguments - the\\n  binding map, and the sequence of all remaining items that the segment\\n  matcher rejected.\\\"\\n  [pattern f]\\n  (let [match (pattern->combinators pattern)\\n        cont (fn ([frame]\\n                  (f frame)\\n                  false)\\n               ([frame xs]\\n                (f frame xs)\\n                false))]\\n    (fn [data]\\n      (match {} data cont))))\", :nextjournal/opts {:id \"emmy.pattern.match/foreach-matcher-code\", :loc {:line 544, :end-line 564, :column 1, :end-column 30}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$foreach_matcher 0x10c3029 \\\"emmy.pattern.match$foreach_matcher@10c3029\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/foreach-matcher-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/foreach-matcher-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn foreach\\n  \\\"Convenience function that creates a [[foreach-matcher]] from the supplied\\n  `pattern` and callback `f` and immediately applies it to `data`.\\n\\n  Equivalent to:\\n\\n  ```clojure\\n  ((foreach-matcher pattern pred) data)\\n  ```\\\"\\n  [pattern f data]\\n  ((foreach-matcher pattern f) data))\", :nextjournal/opts {:id \"emmy.pattern.match/foreach-code\", :loc {:line 566, :end-line 576, :column 1, :end-column 38}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$foreach 0x436509e8 \\\"emmy.pattern.match$foreach@436509e8\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/foreach-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/foreach-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn all-results-matcher\\n  \\\"Takes a `pattern` and callback function `f`, and returns a matcher that takes a\\n  `data` argument and returns a sequence of every possible match of `pattern` to\\n  the data.\\n\\n  For a convenience function that applies the matcher to data immediately,\\n  see [[all-results]].\\n\\n  NOTE: If you pass a segment matcher, `f` must accept two arguments - the\\n  binding map, and the sequence of all remaining items that the segment\\n  matcher rejected.\\\"\\n  [pattern]\\n  (let [match (pattern->combinators pattern)]\\n    (fn [data]\\n      (let [results (atom [])\\n            cont (fn\\n                   ([frame]\\n                    (swap! results conj frame)\\n                    false)\\n                   ([frame xs]\\n                    (swap! results conj [frame xs])\\n                    false))]\\n        (match {} data cont)\\n        @results))))\", :nextjournal/opts {:id \"emmy.pattern.match/all-results-matcher-code\", :loc {:line 578, :end-line 601, :column 1, :end-column 21}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$all_results_matcher 0x4aad7243 \\\"emmy.pattern.match$all_results_matcher@4aad7243\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/all-results-matcher-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/all-results-matcher-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}} {:path [], :nextjournal/value \"(defn all-results\\n  \\\"Convenience function that creates an [[all-results-matcher]] from the supplied\\n  `pattern` and immediately applies it to `data`.\\n\\n  Equivalent to:\\n\\n  ```clojure\\n  ((all-results-matcher pattern pred) data)\\n  ```\\\"\\n  [pattern data]\\n  ((all-results-matcher pattern) data))\", :nextjournal/opts {:id \"emmy.pattern.match/all-results-code\", :loc {:line 603, :end-line 613, :column 1, :end-column 40}}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dru1FUcVRTRrVKJFbNw4FG2wXmiwB\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[emmy.pattern.match$all_results 0x770ebb6 \\\"emmy.pattern.match$all_results@770ebb6\\\"]\", :nextjournal/opts {:id \"emmy.pattern.match/all-results-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (read-string x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5driNqLjrByEWrhxqnAqaiYK9eiYCv\"}}, :nextjournal/blob-id nil}, :nextjournal/opts {:id \"emmy.pattern.match/all-results-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dtGVHesd2XCTLFYF3aY4kJvkrX1x1\"}}], :css-class nil}, :nextjournal/viewer {:name nextjournal.clerk.viewer/notebook-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-notebook, :hash \"5duAFDxE4sCnRX71Wo6zeCpC9C3djE\"}}}, :index \"dev/emmy/notebook.clj\", :browse? false, :git/url \"https://github.com/mentat-collective/emmy\", :paths [\"src/emmy/abstract/number.cljc\" \"src/emmy/special/elliptic.cljc\" \"src/emmy/polynomial/interpolate.cljc\" \"src/emmy/numerical/quadrature/midpoint.cljc\" \"src/emmy/numerical/quadrature/trapezoid.cljc\" \"src/emmy/sci.cljc\" \"src/emmy/calculus/map.cljc\" \"src/emmy/pattern/rule.cljc\" \"src/emmy/mechanics/time_evolution.cljc\" \"src/emmy/util/permute.cljc\" \"src/emmy/expression/cse.cljc\" \"src/emmy/complex.cljc\" \"src/emmy/generic.cljc\" \"src/emmy/expression/compile.cljc\" \"src/emmy/sr/frames.cljc\" \"src/emmy/function.cljc\" \"src/emmy/polynomial/richardson.cljc\" \"src/emmy/numerical/unimin/brent.cljc\" \"src/emmy/numsymb.cljc\" \"src/emmy/calculus/vector_field.cljc\" \"src/emmy/numerical/minimize.cljc\" \"src/emmy/rational_function.cljc\" \"src/emmy/mechanics/noether.cljc\" \"src/emmy/calculus/hodge_star.cljc\" \"src/emmy/series.cljc\" \"src/emmy/series/impl.cljc\" \"src/emmy/calculus/manifold.cljc\" \"src/emmy/util/logic.cljc\" \"src/emmy/util/stopwatch.cljc\" \"src/emmy/numerical/quadrature/adaptive.cljc\" \"src/emmy/mechanics/rotation.cljc\" \"src/emmy/numerical/ode.cljc\" \"src/emmy/numerical/quadrature/riemann.cljc\" \"src/emmy/calculus/connection.cljc\" \"src/emmy/numbers.cljc\" \"src/emmy/algebra/fold.cljc\" \"src/emmy/numerical/multimin/nelder_mead.cljc\" \"src/emmy/polynomial/exponent.cljc\" \"src/emmy/polynomial/factor.cljc\" \"src/emmy/util/def.cljc\" \"src/emmy/abstract/function.cljc\" \"src/emmy/calculus/indexed.cljc\" \"src/emmy/numerical/quadrature.cljc\" \"src/emmy/numerical/quadrature/infinite.cljc\" \"src/emmy/mechanics/routhian.cljc\" \"src/emmy/numerical/quadrature/bulirsch_stoer.cljc\" \"src/emmy/ratio.cljc\" \"src/emmy/calculus/curvature.cljc\" \"src/emmy/numerical/quadrature/milne.cljc\" \"src/emmy/calculus/form_field.cljc\" \"src/emmy/mechanics/hamilton.cljc\" \"src/emmy/expression/render.cljc\" \"src/emmy/util/stream.cljc\" \"src/emmy/calculus/derivative.cljc\" \"dev/emmy/notebook.clj\" \"src/emmy/util/aggregate.cljc\" \"src/emmy/numerical/quadrature/romberg.cljc\" \"src/emmy/numerical/quadrature/boole.cljc\" \"src/emmy/pattern/match.cljc\" \"src/emmy/calculus/metric.cljc\" \"src/emmy/polynomial/gcd.cljc\" \"src/emmy/numerical/quadrature/substitute.cljc\" \"src/emmy/euclid.cljc\" \"src/emmy/calculus/vector_calculus.cljc\" \"src/emmy/collection.cljc\" \"src/emmy/numerical/quadrature/simpson.cljc\" \"src/emmy/calculus/basis.cljc\" \"src/emmy/util/vector_set.cljc\" \"src/emmy/pattern/syntax.cljc\" \"src/emmy/numerical/quadrature/common.cljc\" \"src/emmy/sr/boost.cljc\" \"src/emmy/calculus/coordinate.cljc\" \"src/emmy/calculus/covariant.cljc\" \"src/emmy/numerical/derivative.cljc\" \"src/emmy/simplify/rules.cljc\" \"src/emmy/mechanics/rigid.cljc\" \"src/emmy/quaternion.cljc\" \"src/emmy/rational_function/interpolate.cljc\" \"src/emmy/numerical/unimin/bracket.cljc\" \"src/emmy/numerical/roots/bisect.cljc\" \"src/emmy/numerical/quadrature/simpson38.cljc\" \"src/emmy/mechanics/lagrange.cljc\" \"src/emmy/expression/analyze.cljc\" \"src/emmy/calculus/frame.cljc\" \"src/emmy/pattern/consequence.cljc\" \"src/emmy/env.cljc\" \"src/emmy/util.cljc\" \"src/emmy/matrix.cljc\" \"src/emmy/sci/macros.cljc\" \"src/emmy/numerical/unimin/golden.cljc\" \"src/emmy/special/factorial.cljc\" \"src/emmy/polynomial/impl.cljc\" \"src/emmy/modint.cljc\"], :resource->url {\"/js/viewer.js\" \"https://storage.clerk.garden/nextjournal/clerk-assets@4NdW4yYfmUzzw9xCkmyrJ75nH75d/viewer.js?immutable=true\"}, :current-path \"src/emmy/pattern/match.cljc\", :bundle? false, :git/sha \"f6c3e9c17b1d4631fac22eff112c70d031393ac0\", :path->url {\"src/emmy/abstract/number.cljc\" \"src/emmy/abstract/number.html\", \"src/emmy/special/elliptic.cljc\" \"src/emmy/special/elliptic.html\", \"src/emmy/polynomial/interpolate.cljc\" \"src/emmy/polynomial/interpolate.html\", \"src/emmy/numerical/quadrature/midpoint.cljc\" \"src/emmy/numerical/quadrature/midpoint.html\", \"src/emmy/numerical/quadrature/trapezoid.cljc\" \"src/emmy/numerical/quadrature/trapezoid.html\", \"src/emmy/sci.cljc\" \"src/emmy/sci.html\", \"src/emmy/calculus/map.cljc\" \"src/emmy/calculus/map.html\", \"src/emmy/pattern/rule.cljc\" \"src/emmy/pattern/rule.html\", \"src/emmy/mechanics/time_evolution.cljc\" \"src/emmy/mechanics/time_evolution.html\", \"src/emmy/util/permute.cljc\" \"src/emmy/util/permute.html\", \"src/emmy/expression/cse.cljc\" \"src/emmy/expression/cse.html\", \"src/emmy/complex.cljc\" \"src/emmy/complex.html\", \"src/emmy/generic.cljc\" \"src/emmy/generic.html\", \"src/emmy/expression/compile.cljc\" \"src/emmy/expression/compile.html\", \"src/emmy/sr/frames.cljc\" \"src/emmy/sr/frames.html\", \"src/emmy/function.cljc\" \"src/emmy/function.html\", \"src/emmy/polynomial/richardson.cljc\" \"src/emmy/polynomial/richardson.html\", \"src/emmy/numerical/unimin/brent.cljc\" \"src/emmy/numerical/unimin/brent.html\", \"src/emmy/numsymb.cljc\" \"src/emmy/numsymb.html\", \"src/emmy/calculus/vector_field.cljc\" \"src/emmy/calculus/vector_field.html\", \"src/emmy/numerical/minimize.cljc\" \"src/emmy/numerical/minimize.html\", \"src/emmy/rational_function.cljc\" \"src/emmy/rational_function.html\", \"src/emmy/mechanics/noether.cljc\" \"src/emmy/mechanics/noether.html\", \"src/emmy/calculus/hodge_star.cljc\" \"src/emmy/calculus/hodge_star.html\", \"src/emmy/series.cljc\" \"src/emmy/series.html\", \"src/emmy/series/impl.cljc\" \"src/emmy/series/impl.html\", \"src/emmy/calculus/manifold.cljc\" \"src/emmy/calculus/manifold.html\", \"src/emmy/util/logic.cljc\" \"src/emmy/util/logic.html\", \"src/emmy/util/stopwatch.cljc\" \"src/emmy/util/stopwatch.html\", \"src/emmy/numerical/quadrature/adaptive.cljc\" \"src/emmy/numerical/quadrature/adaptive.html\", \"src/emmy/mechanics/rotation.cljc\" \"src/emmy/mechanics/rotation.html\", \"src/emmy/numerical/ode.cljc\" \"src/emmy/numerical/ode.html\", \"src/emmy/numerical/quadrature/riemann.cljc\" \"src/emmy/numerical/quadrature/riemann.html\", \"src/emmy/calculus/connection.cljc\" \"src/emmy/calculus/connection.html\", \"src/emmy/numbers.cljc\" \"src/emmy/numbers.html\", \"src/emmy/algebra/fold.cljc\" \"src/emmy/algebra/fold.html\", \"src/emmy/numerical/multimin/nelder_mead.cljc\" \"src/emmy/numerical/multimin/nelder_mead.html\", \"src/emmy/polynomial/exponent.cljc\" \"src/emmy/polynomial/exponent.html\", \"src/emmy/polynomial/factor.cljc\" \"src/emmy/polynomial/factor.html\", \"src/emmy/util/def.cljc\" \"src/emmy/util/def.html\", \"src/emmy/abstract/function.cljc\" \"src/emmy/abstract/function.html\", \"src/emmy/calculus/indexed.cljc\" \"src/emmy/calculus/indexed.html\", \"src/emmy/numerical/quadrature.cljc\" \"src/emmy/numerical/quadrature.html\", \"src/emmy/numerical/quadrature/infinite.cljc\" \"src/emmy/numerical/quadrature/infinite.html\", \"src/emmy/mechanics/routhian.cljc\" \"src/emmy/mechanics/routhian.html\", \"src/emmy/numerical/quadrature/bulirsch_stoer.cljc\" \"src/emmy/numerical/quadrature/bulirsch_stoer.html\", \"src/emmy/ratio.cljc\" \"src/emmy/ratio.html\", \"src/emmy/calculus/curvature.cljc\" \"src/emmy/calculus/curvature.html\", \"src/emmy/numerical/quadrature/milne.cljc\" \"src/emmy/numerical/quadrature/milne.html\", \"src/emmy/calculus/form_field.cljc\" \"src/emmy/calculus/form_field.html\", \"src/emmy/mechanics/hamilton.cljc\" \"src/emmy/mechanics/hamilton.html\", \"src/emmy/expression/render.cljc\" \"src/emmy/expression/render.html\", \"src/emmy/util/stream.cljc\" \"src/emmy/util/stream.html\", \"src/emmy/calculus/derivative.cljc\" \"src/emmy/calculus/derivative.html\", \"dev/emmy/notebook.clj\" \"\", \"src/emmy/util/aggregate.cljc\" \"src/emmy/util/aggregate.html\", \"src/emmy/numerical/quadrature/romberg.cljc\" \"src/emmy/numerical/quadrature/romberg.html\", \"src/emmy/numerical/quadrature/boole.cljc\" \"src/emmy/numerical/quadrature/boole.html\", \"src/emmy/pattern/match.cljc\" \"src/emmy/pattern/match.html\", \"src/emmy/calculus/metric.cljc\" \"src/emmy/calculus/metric.html\", \"src/emmy/polynomial/gcd.cljc\" \"src/emmy/polynomial/gcd.html\", \"src/emmy/numerical/quadrature/substitute.cljc\" \"src/emmy/numerical/quadrature/substitute.html\", \"src/emmy/euclid.cljc\" \"src/emmy/euclid.html\", \"src/emmy/calculus/vector_calculus.cljc\" \"src/emmy/calculus/vector_calculus.html\", \"src/emmy/collection.cljc\" \"src/emmy/collection.html\", \"src/emmy/numerical/quadrature/simpson.cljc\" \"src/emmy/numerical/quadrature/simpson.html\", \"src/emmy/calculus/basis.cljc\" \"src/emmy/calculus/basis.html\", \"src/emmy/util/vector_set.cljc\" \"src/emmy/util/vector_set.html\", \"src/emmy/pattern/syntax.cljc\" \"src/emmy/pattern/syntax.html\", \"src/emmy/numerical/quadrature/common.cljc\" \"src/emmy/numerical/quadrature/common.html\", \"src/emmy/sr/boost.cljc\" \"src/emmy/sr/boost.html\", \"src/emmy/calculus/coordinate.cljc\" \"src/emmy/calculus/coordinate.html\", \"src/emmy/calculus/covariant.cljc\" \"src/emmy/calculus/covariant.html\", \"src/emmy/numerical/derivative.cljc\" \"src/emmy/numerical/derivative.html\", \"src/emmy/simplify/rules.cljc\" \"src/emmy/simplify/rules.html\", \"src/emmy/mechanics/rigid.cljc\" \"src/emmy/mechanics/rigid.html\", \"src/emmy/quaternion.cljc\" \"src/emmy/quaternion.html\", \"src/emmy/rational_function/interpolate.cljc\" \"src/emmy/rational_function/interpolate.html\", \"src/emmy/numerical/unimin/bracket.cljc\" \"src/emmy/numerical/unimin/bracket.html\", \"src/emmy/numerical/roots/bisect.cljc\" \"src/emmy/numerical/roots/bisect.html\", \"src/emmy/numerical/quadrature/simpson38.cljc\" \"src/emmy/numerical/quadrature/simpson38.html\", \"src/emmy/mechanics/lagrange.cljc\" \"src/emmy/mechanics/lagrange.html\", \"src/emmy/expression/analyze.cljc\" \"src/emmy/expression/analyze.html\", \"src/emmy/calculus/frame.cljc\" \"src/emmy/calculus/frame.html\", \"src/emmy/pattern/consequence.cljc\" \"src/emmy/pattern/consequence.html\", \"src/emmy/env.cljc\" \"src/emmy/env.html\", \"src/emmy/util.cljc\" \"src/emmy/util.html\", \"src/emmy/matrix.cljc\" \"src/emmy/matrix.html\", \"src/emmy/sci/macros.cljc\" \"src/emmy/sci/macros.html\", \"src/emmy/numerical/unimin/golden.cljc\" \"src/emmy/numerical/unimin/golden.html\", \"src/emmy/special/factorial.cljc\" \"src/emmy/special/factorial.html\", \"src/emmy/polynomial/impl.cljc\" \"src/emmy/polynomial/impl.html\", \"src/emmy/modint.cljc\" \"src/emmy/modint.html\"}, :expanded-paths [\"src/emmy/rational_function/interpolate.cljc\" \"src/emmy/series/impl.cljc\" \"src/emmy/special/factorial.cljc\" \"src/emmy/special/elliptic.cljc\" \"src/emmy/simplify/rules.cljc\" \"src/emmy/numerical/unimin/bracket.cljc\" \"src/emmy/numerical/unimin/brent.cljc\" \"src/emmy/numerical/unimin/golden.cljc\" \"src/emmy/numerical/multimin/nelder_mead.cljc\" \"src/emmy/numerical/derivative.cljc\" \"src/emmy/numerical/ode.cljc\" \"src/emmy/numerical/roots/bisect.cljc\" \"src/emmy/numerical/minimize.cljc\" \"src/emmy/numerical/quadrature.cljc\" \"src/emmy/numerical/quadrature/riemann.cljc\" \"src/emmy/numerical/quadrature/bulirsch_stoer.cljc\" \"src/emmy/numerical/quadrature/trapezoid.cljc\" \"src/emmy/numerical/quadrature/common.cljc\" \"src/emmy/numerical/quadrature/boole.cljc\" \"src/emmy/numerical/quadrature/substitute.cljc\" \"src/emmy/numerical/quadrature/milne.cljc\" \"src/emmy/numerical/quadrature/simpson.cljc\" \"src/emmy/numerical/quadrature/simpson38.cljc\" \"src/emmy/numerical/quadrature/midpoint.cljc\" \"src/emmy/numerical/quadrature/adaptive.cljc\" \"src/emmy/numerical/quadrature/infinite.cljc\" \"src/emmy/numerical/quadrature/romberg.cljc\" \"src/emmy/abstract/function.cljc\" \"src/emmy/abstract/number.cljc\" \"src/emmy/expression/cse.cljc\" \"src/emmy/expression/analyze.cljc\" \"src/emmy/expression/render.cljc\" \"src/emmy/expression/compile.cljc\" \"src/emmy/algebra/fold.cljc\" \"src/emmy/calculus/indexed.cljc\" \"src/emmy/calculus/covariant.cljc\" \"src/emmy/calculus/hodge_star.cljc\" \"src/emmy/calculus/derivative.cljc\" \"src/emmy/calculus/frame.cljc\" \"src/emmy/calculus/coordinate.cljc\" \"src/emmy/calculus/manifold.cljc\" \"src/emmy/calculus/curvature.cljc\" \"src/emmy/calculus/connection.cljc\" \"src/emmy/calculus/map.cljc\" \"src/emmy/calculus/form_field.cljc\" \"src/emmy/calculus/metric.cljc\" \"src/emmy/calculus/vector_calculus.cljc\" \"src/emmy/calculus/vector_field.cljc\" \"src/emmy/calculus/basis.cljc\" \"src/emmy/sci/macros.cljc\" \"src/emmy/pattern/rule.cljc\" \"src/emmy/pattern/match.cljc\" \"src/emmy/pattern/consequence.cljc\" \"src/emmy/pattern/syntax.cljc\" \"src/emmy/sr/boost.cljc\" \"src/emmy/sr/frames.cljc\" \"src/emmy/mechanics/hamilton.cljc\" \"src/emmy/mechanics/rotation.cljc\" \"src/emmy/mechanics/noether.cljc\" \"src/emmy/mechanics/time_evolution.cljc\" \"src/emmy/mechanics/lagrange.cljc\" \"src/emmy/mechanics/routhian.cljc\" \"src/emmy/mechanics/rigid.cljc\" \"src/emmy/util/logic.cljc\" \"src/emmy/util/aggregate.cljc\" \"src/emmy/util/def.cljc\" \"src/emmy/util/stopwatch.cljc\" \"src/emmy/util/stream.cljc\" \"src/emmy/util/permute.cljc\" \"src/emmy/util/vector_set.cljc\" \"src/emmy/polynomial/richardson.cljc\" \"src/emmy/polynomial/exponent.cljc\" \"src/emmy/polynomial/interpolate.cljc\" \"src/emmy/polynomial/factor.cljc\" \"src/emmy/polynomial/impl.cljc\" \"src/emmy/polynomial/gcd.cljc\" \"src/emmy/collection.cljc\" \"src/emmy/complex.cljc\" \"src/emmy/euclid.cljc\" \"src/emmy/env.cljc\" \"src/emmy/function.cljc\" \"src/emmy/generic.cljc\" \"src/emmy/matrix.cljc\" \"src/emmy/modint.cljc\" \"src/emmy/numbers.cljc\" \"src/emmy/numsymb.cljc\" \"src/emmy/quaternion.cljc\" \"src/emmy/ratio.cljc\" \"src/emmy/rational_function.cljc\" \"src/emmy/sci.cljc\" \"src/emmy/series.cljc\" \"src/emmy/util.cljc\" \"dev/emmy/notebook.clj\"], :cname \"emmy.mentat.org\", :watch-paths [\"src\" \"dev\"], :report-fn #object[nextjournal.clerk.builder$stdout_reporter 0x22705207 \"nextjournal.clerk.builder$stdout_reporter@22705207\"]}".replaceAll('nextjournal.clerk.view/escape-closing-script-tag', 'script')
let opts = nextjournal.clerk.sci_env.read_string(state)
nextjournal.clerk.static_app.init(opts)
</script></body></html>